(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.translateContract = translateContract;
exports.Contract = void 0;

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

/**
 * @author Noah-Vincenz Noeh <noah-vincenz.noeh18@imperial.ac.uk>
 */

/* jshint esversion: 6 */
var Contract = function Contract(id, amount, recipient, contractString, meaningOfContractString, horizonDate, toBeExecutedAtHorizon, status) {
  _classCallCheck(this, Contract);

  this.id = id;
  this.amount = amount;
  this.recipient = recipient;
  this.contractString = contractString;
  this.meaningOfContractString = meaningOfContractString;
  this.horizonDate = horizonDate;
  this.toBeExecutedAtHorizon = toBeExecutedAtHorizon;
  this.status = status;
};

exports.Contract = Contract;

function translateContract(recipient, amount, horizonDate, acquireAtHorizon) {
  var to = " owner ";
  var from = " counter-party ";
  var hDate = "";

  if (recipient === 1) {
    to = " counter-party ";
    from = " owner ";
  }

  if (horizonDate !== "infinite") {
    if (acquireAtHorizon === "yes") {
      hDate = " at " + horizonDate;
    } else {
      hDate = " before " + horizonDate;
    }
  }

  var adj = " is";

  if (parseFloat(amount) !== 1) {
    if (parseFloat(amount) === 0) {
      adj = " are";
    } else {
      adj = "s are";
    }
  }

  return amount + " Ether" + adj + " transferred from the " + from + " address to the " + to + " address" + hDate + ".";
}

},{}],2:[function(require,module,exports){
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getSelectedMetaMaskAccount = getSelectedMetaMaskAccount;
exports.setDefaultAccount = setDefaultAccount;
exports.setSmartContractInstance = setSmartContractInstance;
exports.instantiateNew = instantiateNew;
exports.depositCollateral = depositCollateral;
exports.holderBalance = holderBalance;
exports.counterPartyBalance = counterPartyBalance;
exports.holderAddress = holderAddress;
exports.counterPartyAddress = counterPartyAddress;
exports.balanceOfAddress = balanceOfAddress;
exports.transfer = transfer;
exports.waitForReceipt = waitForReceipt;

var _resources = require("./resources.mjs");

/**
 * @author Noah-Vincenz Noeh <noah-vincenz.noeh18@imperial.ac.uk>
 */

/* jshint esversion: 6 */
var abi;
var codeHex;
var smartContract;
var smartContractInstance;
window.addEventListener('load', function () {
  if (typeof web3 !== 'undefined') {
    console.log('Web3 Detected! ' + web3.currentProvider.constructor.name);
    console.log("Web3 Version: " + web3.version.api);
    abi = _resources.ABI;
    codeHex = web3.toHex(_resources.CODE_HEX);
    smartContract = web3.eth.contract(abi);
  } else {
    console.log('No Web3 Detected... using HTTP Provider');
    window.web3 = new Web3(new Web3.providers.HttpProvider("http://localhost:8545"));
  }
});

function getSelectedMetaMaskAccount() {
  return web3.eth.accounts[0];
}

function setDefaultAccount(address) {
  web3.eth.defaultAccount = address;
}

function setSmartContractInstance(contractAddress) {
  smartContractInstance = smartContract.at(contractAddress);
} // this does not exist for Kovan chain


function unlockAccount(address) {
  return new Promise(function (resolve, reject) {
    web3.personal.unlockAccount(address, "user", web3.toHex(0), function (err, result) {
      if (err) {
        reject(err);
      } else {
        console.log("Account has been unlocked: " + JSON.stringify(result));
        resolve();
      }
    });
  });
}

function instantiateNew(holderAddress, counterPartyAddress) {
  return new Promise(function (resolve, reject) {
    smartContract["new"](holderAddress, counterPartyAddress, {
      data: codeHex,
      from: web3.eth.defaultAccount
    }, function (err, contractInstance) {
      //smartContract.new({data: dataIn, from: web3.eth.defaultAccount, gasPrice: 4000000000, gas: gasLimit}, function (err, contractInstance) {
      if (err) {
        reject(err);
      } else {
        var transactionHash = contractInstance.transactionHash;
        console.log("TransactionHash: " + transactionHash + " waiting to be mined...");
        resolve(transactionHash);
      }
    });
  });
}

function depositCollateral(senderAddress, amount) {
  return new Promise(function (resolve, reject) {
    smartContractInstance.depositCollateral(amount, {
      from: senderAddress,
      value: web3.toWei(amount, "ether")
    }, function (err, result) {
      if (err) {
        reject(err);
      } else {
        resolve(result.toString(10));
      }
    });
  });
}

function holderBalance() {
  return new Promise(function (resolve, reject) {
    smartContractInstance.holderBalance(function (err, result) {
      if (err) {
        reject(err);
      } else {
        resolve(web3.toDecimal(result));
      }
    });
  });
}

function counterPartyBalance() {
  return new Promise(function (resolve, reject) {
    smartContractInstance.counterPartyBalance(function (err, result) {
      if (err) {
        reject(err);
      } else {
        resolve(web3.toDecimal(result));
      }
    });
  });
}

function holderAddress() {
  return new Promise(function (resolve, reject) {
    smartContractInstance.holderAddress(function (err, result) {
      if (err) {
        reject(err);
      } else {
        var unpaddedAddr = web3.toHex(result.toString(10)); // pad address to length of 42

        var paddedAddr = unpaddedAddr.split("0x")[1].padStart(40, '0');
        resolve("0x" + paddedAddr);
      }
    });
  });
}

function counterPartyAddress() {
  return new Promise(function (resolve, reject) {
    smartContractInstance.counterPartyAddress(function (err, result) {
      if (err) {
        reject(err);
      } else {
        var unpaddedAddr = web3.toHex(result.toString(10)); // pad address to length of 42

        var paddedAddr = unpaddedAddr.split("0x")[1].padStart(40, '0');
        resolve("0x" + paddedAddr);
      }
    });
  });
}

function balanceOfAddress(address) {
  return new Promise(function (resolve, reject) {
    smartContractInstance.balanceOfAddress(web3.toChecksumAddress(address), function (err, result) {
      if (err) {
        reject(err);
      } else {
        resolve(web3.toDecimal(result));
      }
    });
  });
}

function transfer(fromAddress, toAddress, amount) {
  return new Promise(function (resolve, reject) {
    smartContractInstance.transfer(fromAddress, toAddress, amount, function (err, result) {
      if (err) {
        reject(err);
      } else {
        resolve(result);
      }
    });
  });
}

function waitForReceipt(transactionHash) {
  return new Promise(function (resolve, reject) {
    web3.eth.getTransactionReceipt(transactionHash, function (err, receipt) {
      if (err) {
        reject(err);
      } else {
        if (receipt !== null) {
          // Transaction went through
          resolve(receipt);
        } else {
          // Try again in 1 second
          window.setTimeout(function () {
            waitForReceipt(transactionHash);
          }, 1000);
        }
      }
    });
  });
}

},{"./resources.mjs":3}],3:[function(require,module,exports){
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.CODE_HEX = exports.ABI = void 0;
var ABI = [{
  "type": "function",
  "name": "balanceOfAddress",
  "inputs": [{
    "name": "_address",
    "type": "address"
  }],
  "outputs": [{
    "name": "returnValue0",
    "type": "uint256"
  }],
  "constant": true,
  "payable": false
}, {
  "type": "function",
  "name": "holderBalance",
  "inputs": [],
  "outputs": [{
    "name": "returnValue0",
    "type": "uint256"
  }],
  "constant": true,
  "payable": false
}, {
  "type": "function",
  "name": "counterPartyBalance",
  "inputs": [],
  "outputs": [{
    "name": "returnValue0",
    "type": "uint256"
  }],
  "constant": true,
  "payable": false
}, {
  "type": "function",
  "name": "callerBalance",
  "inputs": [],
  "outputs": [{
    "name": "returnValue0",
    "type": "uint256"
  }],
  "constant": true,
  "payable": false
}, {
  "type": "function",
  "name": "holderAddress",
  "inputs": [],
  "outputs": [{
    "name": "returnValue0",
    "type": "uint256"
  }],
  "constant": true,
  "payable": false
}, {
  "type": "function",
  "name": "counterPartyAddress",
  "inputs": [],
  "outputs": [{
    "name": "returnValue0",
    "type": "uint256"
  }],
  "constant": true,
  "payable": false
}, {
  "type": "function",
  "name": "callerAddress",
  "inputs": [],
  "outputs": [{
    "name": "returnValue0",
    "type": "uint256"
  }],
  "constant": true,
  "payable": false
}, {
  "type": "function",
  "name": "transfer",
  "inputs": [{
    "name": "_from",
    "type": "address"
  }, {
    "name": "_to",
    "type": "address"
  }, {
    "name": "_amount",
    "type": "uint256"
  }],
  "outputs": [],
  "constant": false,
  "payable": false
}, {
  "type": "function",
  "name": "depositCollateral",
  "inputs": [{
    "name": "amount",
    "type": "uint256"
  }],
  "outputs": [],
  "constant": false,
  "payable": true
}, {
  "type": "event",
  "name": "SmartContract",
  "inputs": [{
    "name": "indexed_from",
    "type": "address",
    "indexed": true
  }, {
    "name": "_value",
    "type": "uint256",
    "indexed": false
  }]
}, {
  "type": "event",
  "name": "Transfer",
  "inputs": [{
    "name": "indexed_from",
    "type": "address",
    "indexed": true
  }, {
    "name": "indexed_to",
    "type": "address",
    "indexed": true
  }, {
    "name": "_value",
    "type": "uint256",
    "indexed": false
  }]
}, {
  "type": "constructor",
  "inputs": [{
    "name": "holder_address",
    "type": "address"
  }, {
    "name": "counter_party_address",
    "type": "address"
  }]
}];
exports.ABI = ABI;
var CODE_HEX = '0x0061736d01000000013b0a60047f7f7f7f0060027f7f017f60017f017f60027f7f0060017f006000017f60000060057f7f7f7f7f0060057f7f7f7f7f017f60037f7f7f017f026b0703656e760576616c7565000403656e760c696e7075745f6c656e677468000503656e760b66657463685f696e707574000403656e760570616e6963000303656e760d73746f726167655f7772697465000303656e76066d656d6f72790201021003656e7603726574000303282703030703030002030603030606040406010300080401020001020804040400040304060103090604050170010a0a0608017f01418080040b0708010463616c6c002c090f010041010b091a1d1e1f23181b1c220af21d276d01037f230041206b22022400200241086a41106a22034100360200200241086a41086a2204420037030020024200370308200241086a41142001410c6a4114100b200041106a2003280200360000200041086a200429030037000020002002290308370000200241206a24000b7d01047f230041206b22022400200241186a22034200370300200241106a22044200370300200241086a22054200370300200242003703002002410c6a411420014114100b200041186a2003290300370000200041106a2004290300370000200041086a200529030037000020002002290300370000200241206a24000b39000240024020022001490d0020042002490d012000200220016b3602042000200320016a3602000f0b200120021009000b20022004100a000b05001011000b05001011000b1900024020012003470d00200020022001102b1a0f0b1011000bb00101027f230041106b220124000240024002402000450d00200041036a4102762200417f6a220241ff014b0d01200241027441e884046a2202450d01200141e484043602042001200228020036020c200041012001410c6a200141046a41b08004101921002002200128020c3602000c020b410121000c010b200141002802e4840436020820004101200141086a41f8830441c8800410192100410020012802083602e484040b200141106a240020000bad0101017f230041106b2202240002402000450d00200220003602042001450d000240200141036a410276417f6a220041ff014b0d00200041027441e884046a2200450d00200241e484043602082002200028020036020c200241046a2002410c6a200241086a41b0800410242000200228020c3602000c010b200241002802e4840436020c200241046a2002410c6a41f8830441c8800410244100200228020c3602e484040b200241106a24000b090041e080041025000b040000000b100002402001450d0020002001100d0b0b05001015000b0500100e000be50101037f230041c0006b22012400200141186a4200370300200141106a4200370300200141086a42003703002001420037030020011000200141206a41186a4200370300200141206a41106a4200370300200141206a41086a420037030020014200370320411f2102200141206a2103024003402002417f460d012003200120026a2d00003a00002002417f6a2102200341016a21030c000b0b20002001290320370300200041186a200141206a41186a290300370300200041106a200141206a41106a290300370300200041086a200141206a41086a290300370300200141c0006a24000b5901037f024002400240024010012201450d002001417f4c0d022001100c2202450d0320021002200121030c010b41002103410121020b2000200336020420002002360200200020013602080f0b1012000b20014101100f000b0900410041001003000b7002017f027e200041186a2100200141186a21024103210102400240024003402001417f460d01200141034b0d032000290300220320022903002204540d02200041786a2100200241786a21022001417f6a210120032004580d000b41010f0b41000f0b41ff010f0b200141041017000b05001011000b920101027f230041106b2204240020042001280200220128020036020c200241026a220220026c220241801020024180104b1b220541042004410c6a41f8830441988004101921022001200428020c360200024002402002450d00200242003702042002200220054102746a410272360200410021010c010b410121010b2000200236020420002001360200200441106a24000b6b01027f230041106b22052400024020002001200220032004102022060d00200541086a200320002001200428020c1100004100210620052802080d00200528020c220620022802003602082002200636020020002001200220032004102021060b200541106a240020060b02000b040020010b040041000b7201017f41002104024002404100200241027422022003410374418080016a220320032002491b418780046a2202411076400022034110742003417f461b2203450d00200342003702042003200320024180807c716a4102723602000c010b410121040b20002003360204200020043602000b05004180040b040041010bc90301067f2001417f6a2105410020016b21062000410274210720022802002108200441106a2109024002400240024003402008450d012008210102400340200141086a210420012802082208410171450d0120042008417e71360200024002402001280204417c712208450d004100200820082d00004101711b21080c010b410021080b20011021024020012d0000410271450d00200820082802004102723602000b20022008360200200821010c000b0b02402001280200417c71220a20046b2007490d0020042003200020092802001101004102746a41086a200a20076b20067122084d0d03200428020021082005200471450d040b200220083602000c000b0b41000f0b20084100360200200841786a2208420037020020082001280200417c71360200024020012802002202417c712204450d0020024102710d00200420042802044103712008723602040b20082008280204410371200172360204200141086a22042004280200417e7136020020012001280200220441037120087222023602002004410271450d0120012002417d71360200200820082802004102723602000c010b20022008417c71360200200121080b20082008280200410172360200200841086a0b8f0101027f0240024020002802002201417c712202450d0020014102710d00200220022802044103712000280204417c7172360204200041046a21020c010b200041046a21020b024020022802002202417c712201450d00200120012802004103712000280200417c7172360200200028020421020b200041046a2002410371360200200020002802004103713602000b02000b02000bb80101017f200028020022044100360200200441786a22002000280200417e71360200024020022003280214110200450d0002402004417c6a280200417c712202450d0020022d00004101710d0020001021024020002d0000410271450d00200220022802004102723602000b0f0b20002802002202417c712203450d0020024102710d0020032d00004101710d0020042003280208417c71360200200320004101723602080f0b20042001280200360200200120003602000b05001011000bb106010b7f230041d0016b22022400024002402001280208220341206a2204200128020422054d0d00200241f0006a41176a20024190016a41176a290000370000200241f0006a41106a20024190016a41106a290300370300200241f0006a41086a20024190016a41086a2903003703002002200229039001370370200241306a41176a200241d0006a41176a290000370000200241306a41106a200241d0006a41106a290300370300200241306a41086a200241d0006a41086a29030037030020022002290350370330200041033a0001410121010c010b200141086a2004360200200241086a20032004200128020020051008200228020c210320022802082105200241c8016a22044200370300200241b0016a41106a4200370300200241b0016a41086a4200370300200242003703b00141002101200241004120200520031008200241b0016a412020022802002002280204100b20024190016a41086a2203200241b0016a41096a220629000037030020024190016a41106a2205200241b0016a41116a220729000037030020024190016a41176a22082004290000370000200220022900b1013703900120022d00b0012109200241f0006a41176a220a2008290000370000200241f0006a41106a22082005290300370300200241f0006a41086a220b20032903003703002002200229039001370370200241d0006a41176a220c200a290000370000200241d0006a41106a220a2008290300370300200241d0006a41086a2208200b29030037030020022002290370370350200241306a41176a220b200c290000370000200241306a41106a220c200a290300370300200241306a41086a220a200829030037030020022002290350370330200241106a41176a2208200b290000370000200241106a41106a220b200c290300370300200241106a41086a220c200a290300370300200220022903303703102006200c2903003700002007200b29030037000020042008290000370000200220093a00b001200220022903103700b10120024190016a200241b0016a1006200041116a2005280000360000200041096a200329000037000020002002290090013700010b200020013a0000200241d0016a24000b05001011000bd20301057f230041b0016b22002400200041086a10142000280210210120002802082102200041d8006a1013200041f8006a41186a4200370300200041f8006a41106a4200370300200041f8006a41086a4200370300200042003703780240200041d8006a200041f8006a10290d002000200136021c2000200236021820004100360220200041f8006a200041186a1026200041286a200041f8006a102a200041f8006a200041186a1026200041c0006a200041f8006a102a200041d8006a41186a22014200370300200041d8006a41106a4200370300200041d8006a41086a42003703002000420037035820004198016a41106a2203200041286a41106a28020036020020004198016a41086a2204200041286a41086a2903003703002000200029032837039801200041f8006a20004198016a1007200041d8006a200041f8006a100420014200370000200041e9006a4200370000200041e1006a420037000020004200370059200041013a00582003200041c0006a41106a2802003602002004200041c0006a41086a2903003703002000200029034037039801200041f8006a20004198016a1007200041d8006a200041f8006a10042002200028020c1010200041b0016a24000f0b41c081041025000b0f0020002001101641ff01714101460b4b01017f200141016a2102024020012d00004101460d0020002002290000370000200041106a200241106a280000360000200041086a200241086a2900003700000f0b20022d00001027000b3001017f410021030240034020022003460d01200020036a200120036a2d00003a0000200341016a21030c000b0b20000b0e00102841ec8c0441f1e40010050b0bf8710400418080040bd801d800010020000000f800010062000000d3070000090000000100000000000000010000000200000003000000040000000500000004000000040000000600000007000000080000000900000000000000010000000200000003000000040000005a010100110000006b01010013000000f5020000050000007e0101001d0000009b0101005d000000290000000200000050020100120000002e0201000a000000340000000200000038020100180000002e0201000a0000003400000002000000f8010100360000002e0201000a00000034000000020000000041d881040b8a03617373657274696f6e206661696c65643a2038203c3d206275662e6c656e28292f55736572732f6e6f61682d76696e63656e7a6e6f65682f2e636172676f2f72656769737472792f7372632f6769746875622e636f6d2d316563633632393964623965633832332f627974656f726465722d312e332e302f7372632f6c69622e72736361706163697479206f766572666c6f776c6962616c6c6f632f7261775f7665632e727361726974686d65746963206f7065726174696f6e206f766572666c6f772f55736572732f6e6f61682d76696e63656e7a6e6f65682f2e636172676f2f72656769737472792f7372632f6769746875622e636f6d2d316563633632393964623965633832332f75696e742d302e352e302f7372632f6c69622e7273556e61626c6520746f206163636570742076616c756520696e206e6f6e2d70617961626c6520636f6e7374727563746f722063616c6c7372632f6c69622e7273496e76616c6964206d6574686f64207369676e6174757265496e76616c69642061626920696e766f6b650041e484040b840800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000041ec8c040bf1640061736d0100000001410b60047f7f7f7f0060027f7f017f60017f017f60027f7f0060017f006000017f60000060057f7f7f7f7f0060037f7f7f0060057f7f7f7f7f017f60037f7f7f017f0296010a03656e760c73746f726167655f72656164000303656e760673656e646572000403656e760576616c7565000403656e760c696e7075745f6c656e677468000503656e760b66657463685f696e707574000403656e7603726574000303656e760570616e6963000303656e760d73746f726167655f7772697465000303656e7604656c6f67000003656e76066d656d6f727902010210033c3b0303030303030307030308030002030603030403060703060404040306010300090401020001020904040400040303030303080401030608030a0a04050170010a0a0608017f01418080040b0708010463616c6c003f090f010041010b092a2d2e2f33282b2c320a9e553b6801017f230041c0006b2202240020022001100a200241206a41186a200241186a290000370300200241206a41106a200241106a290000370300200241206a41086a200241086a290000370300200220022900003703202000200241206a100b200241c0006a24000b7601047f230041206b22022400200241186a22034200370300200241106a22044200370300200241086a2205420037030020024200370300200120021000200041186a2003290300370000200041106a2004290300370000200041086a200529030037000020002002290300370000200241206a24000b6d01037f230041206b22022400200241086a41106a22034100360200200241086a41086a2204420037030020024200370308200241086a41142001410c6a41141015200041106a2003280200360000200041086a200429030037000020002002290308370000200241206a24000b2e01017f230041c0006b22022400200241206a2001100d2002200241206a100a20002002100e200241c0006a24000b9c0101017f230041c0006b22022400200241286a41106a200141106a280000360200200241286a41086a200141086a29000037030020022001290000370328200241086a200241286a100f200041086a200241086a41086a290300370000200041106a200241086a41106a290300370000200041186a200241086a41186a290300370000200241013a000820002002290308370000200241c0006a24000bea0101027f230041c0006b220241186a200141186a290000370300200241106a200141106a290000370300200241086a200141086a29000037030020022001290000370300200241206a41186a4200370300200241206a41106a4200370300200241206a41086a420037030020024200370320411f2101200241206a2103024003402001417f460d012003200220016a2d00003a00002001417f6a2101200341016a21030c000b0b20002002290320370300200041186a200241206a41186a290300370300200041106a200241206a41106a290300370300200041086a200241206a41086a2903003703000b7d01047f230041206b22022400200241186a22034200370300200241106a22044200370300200241086a22054200370300200242003703002002410c6a4114200141141015200041186a2003290300370000200041106a2004290300370000200041086a200529030037000020002002290300370000200241206a24000b39000240024020022001490d0020042002490d012000200220016b3602042000200320016a3602000f0b200120021011000b200220041012000b0500101d000b0500101d000b2e01017f2000200220016b2202101420002000280208220320026a360208200320002802006a20022001200210150b9c0101037f02400240024020002802042202200028020822036b20014f0d00200320016a22012003490d0120024101742203200120012003491b22014100480d01024002402002450d0020002802002104200110162203450d042003200420012002200220014b1b10421a2004200210170c010b200110162203450d030b20002003360200200041046a20013602000b0f0b1018000b200141011019000b1900024020012003470d0020002002200110421a0f0b101d000bb00101027f230041106b220124000240024002402000450d00200041036a4102762200417f6a220241ff014b0d01200241027441e884046a2202450d01200141e484043602042001200228020036020c200041012001410c6a200141046a41b08004102921002002200128020c3602000c020b410121000c010b200141002802e4840436020820004101200141086a41f8830441c8800410292100410020012802083602e484040b200141106a240020000bad0101017f230041106b2202240002402000450d00200220003602042001450d000240200141036a410276417f6a220041ff014b0d00200041027441e884046a2200450d00200241e484043602082002200028020036020c200241046a2002410c6a200241086a41b0800410342000200228020c3602000c010b200241002802e4840436020c200241046a2002410c6a41f8830441c8800410344100200228020c3602e484040b200241106a24000b090041e080041035000b040000000b100002402001450d002000200110170b0b4101017f0240412010162201450d00200020013602042000412036020020004201370210200041086a4220370200200041186a41003602000f0b412041011019000b830101047f230041106b2202240002402001410c6a22032802002001280200470d00200241086a2204200328020036020020022001290204370300200141146a28020021052002200128021022032003200141186a2802006a1013200041086a20042802003602002000200229030037020020032005101a200241106a24000f0b101d000b05001025000b39000240024020022001490d0020042002490d012000200220016b3602042000200320016a3602000f0b200120021011000b200220041012000b4d01017f230041206b22022400200241086a41106a200141106a280000360200200241086a41086a200141086a290000370300200220012900003703082000200241086a100f200241206a24000b05001018000b6401037f230041206b22012400200141086a41106a22024100360200200141086a41086a2203420037030020014200370308200141086a1001200041106a2002280200360000200041086a200329030037000020002001290308370000200141206a24000be50101037f230041c0006b22012400200141186a4200370300200141106a4200370300200141086a42003703002001420037030020011002200141206a41186a4200370300200141206a41106a4200370300200141206a41086a420037030020014200370320411f2102200141206a2103024003402002417f460d012003200120026a2d00003a00002002417f6a2102200341016a21030c000b0b20002001290320370300200041186a200141206a41186a290300370300200041106a200141206a41106a290300370300200041086a200141206a41086a290300370300200141c0006a24000b5901037f024002400240024010032201450d002001417f4c0d02200110162202450d0320021004200121030c010b41002103410121020b2000200336020420002002360200200020013602080f0b1020000b200141011019000b0900200020011005000b0900410041001006000b7002017f027e200041186a2100200141186a21024103210102400240024003402001417f460d01200141034b0d032000290300220320022903002204540d02200041786a2100200241786a21022001417f6a210120032004580d000b41010f0b41000f0b41ff010f0b200141041027000b0500101d000b920101027f230041106b2204240020042001280200220128020036020c200241026a220220026c220241801020024180104b1b220541042004410c6a41f8830441988004102921022001200428020c360200024002402002450d00200242003702042002200220054102746a410272360200410021010c010b410121010b2000200236020420002001360200200441106a24000b6b01027f230041106b22052400024020002001200220032004103022060d00200541086a200320002001200428020c1100004100210620052802080d00200528020c220620022802003602082002200636020020002001200220032004103021060b200541106a240020060b02000b040020010b040041000b7201017f41002104024002404100200241027422022003410374418080016a220320032002491b418780046a2202411076400022034110742003417f461b2203450d00200342003702042003200320024180807c716a4102723602000c010b410121040b20002003360204200020043602000b05004180040b040041010bc90301067f2001417f6a2105410020016b21062000410274210720022802002108200441106a2109024002400240024003402008450d012008210102400340200141086a210420012802082208410171450d0120042008417e71360200024002402001280204417c712208450d004100200820082d00004101711b21080c010b410021080b20011031024020012d0000410271450d00200820082802004102723602000b20022008360200200821010c000b0b02402001280200417c71220a20046b2007490d0020042003200020092802001101004102746a41086a200a20076b20067122084d0d03200428020021082005200471450d040b200220083602000c000b0b41000f0b20084100360200200841786a2208420037020020082001280200417c71360200024020012802002202417c712204450d0020024102710d00200420042802044103712008723602040b20082008280204410371200172360204200141086a22042004280200417e7136020020012001280200220441037120087222023602002004410271450d0120012002417d71360200200820082802004102723602000c010b20022008417c71360200200121080b20082008280200410172360200200841086a0b8f0101027f0240024020002802002201417c712202450d0020014102710d00200220022802044103712000280204417c7172360204200041046a21020c010b200041046a21020b024020022802002202417c712201450d00200120012802004103712000280200417c7172360200200028020421020b200041046a2002410371360200200020002802004103713602000b02000b02000bb80101017f200028020022044100360200200441786a22002000280200417e71360200024020022003280214110200450d0002402004417c6a280200417c712202450d0020022d00004101710d0020001031024020002d0000410271450d00200220022802004102723602000b0f0b20002802002202417c712203450d0020024102710d0020032d00004101710d0020042003280208417c71360200200320004101723602080f0b20042001280200360200200120003602000b0500101d000bc50201037f230041c0006b220224000240024002402001280208220341206a220420012802044d0d0020004181063b01000c010b200141086a2004360200200341604f0d0120012802002101200241386a4200370300200241306a4200370300200241206a41086a420037030020024200370320200120036a2104411f2101200241206a2103024003402001417f460d012003200420016a2d00003a00002001417f6a2101200341016a21030c000b0b200241186a2201200241206a41186a290300370300200241106a2203200241206a41106a290300370300200241086a2204200241206a41086a29030037030020022002290320370300200041003a0000200041206a2001290300370300200041186a2003290300370300200041106a2004290300370300200041086a20022903003703000b200241c0006a24000f0b200320041011000bb106010b7f230041d0016b22022400024002402001280208220341206a2204200128020422054d0d00200241f0006a41176a20024190016a41176a290000370000200241f0006a41106a20024190016a41106a290300370300200241f0006a41086a20024190016a41086a2903003703002002200229039001370370200241306a41176a200241d0006a41176a290000370000200241306a41106a200241d0006a41106a290300370300200241306a41086a200241d0006a41086a29030037030020022002290350370330200041033a0001410121010c010b200141086a2004360200200241086a20032004200128020020051010200228020c210320022802082105200241c8016a22044200370300200241b0016a41106a4200370300200241b0016a41086a4200370300200242003703b00141002101200241004120200520031010200241b0016a412020022802002002280204101520024190016a41086a2203200241b0016a41096a220629000037030020024190016a41106a2205200241b0016a41116a220729000037030020024190016a41176a22082004290000370000200220022900b1013703900120022d00b0012109200241f0006a41176a220a2008290000370000200241f0006a41106a22082005290300370300200241f0006a41086a220b20032903003703002002200229039001370370200241d0006a41176a220c200a290000370000200241d0006a41106a220a2008290300370300200241d0006a41086a2208200b29030037030020022002290370370350200241306a41176a220b200c290000370000200241306a41106a220c200a290300370300200241306a41086a220a200829030037030020022002290350370330200241106a41176a2208200b290000370000200241106a41106a220b200c290300370300200241106a41086a220c200a290300370300200220022903303703102006200c2903003700002007200b29030037000020042008290000370000200220093a00b001200220022903103700b10120024190016a200241b0016a100b200041116a2005280000360000200041096a200329000037000020002002290090013700010b200020013a0000200241d0016a24000b880402077f017e230041306b22022400200241106a41186a200141186a290300370300200241106a41106a200141106a290300370300200241106a41086a200141086a290300370300200220012903003703102000410c6a2201280200220341206a210402400240200341604f0d00200041046a2205412010142005280200200128020022066a21074100210102400340200720016a2105200141016a2208411f4b0d01200541003a0000200821010c000b0b200541003a0000200620016a41016a21010c010b4100210102400340200320016a41206a220520034f0d01200541016a2005490d01200141016a21010c000b0b200320016b21010b2000410c6a2001360200200241086a20032004200041046a2802002001101e200241286a210541002108200228020c21072002280208210041032103410021010240024002400340200141034b0d0120022008200720002007101e200341034b0d02200228020441074d0d03200141016a2101200228020020052903002209423886200942288642808080808080c0ff0083842009421886428080808080e03f8320094208864280808080f01f838484200942088842808080f80f832009421888428080fc07838420094228884280fe03832009423888848484370000200841086a2108200541786a21052003417f6a21030c000b0b200241306a24000f0b200341041027000b418080041035000b9f0101017f230041c0006b22022400200241186a200141186a290000370300200241106a200141106a290000370300200241086a200141086a29000037030020022001290000370300200241206a41186a4200370300200241206a41106a4200370300200241206a41086a420037030020024200370320200241206a4120200241201015200041046a200241206a200241206a41206a1013200241c0006a24000bf80202047f017e230041c0006b22022400200241186a2203200141186a290300370300200241106a200141106a290300370300200241086a200141086a29030037030020022001290300370300200241206a41186a4200370300200241206a41106a4200370300200241206a41086a42003703002002420037032041002101200241206a210441032105024002400340200141034b0d01200541034b0d02200420032903002206423886200642288642808080808080c0ff0083842006421886428080808080e03f8320064208864280808080f01f838484200642088842808080f80f832006421888428080fc07838420064228884280fe03832006423888848484370000200441086a21042005417f6a2105200341786a2103200141016a21010c000b0b20002002290320370000200041186a200241206a41186a290300370000200041106a200241206a41106a290300370000200041086a200241206a41086a290300370000200241c0006a24000f0b417f41041027000bec0103027e017f057e2001290308220320022903087c2204200354210520022903182106200229031021072001290318210320012903102108024002402001290300220920022903007c220a20095a0d00200442017c220920045420056a21050c010b200421090b200820077c22042008542101024002402005450d0020042005ad7c220720045420016a21010c010b200421070b200320067c220820035421020240024002402001450d0020082001ad7c220320085420026a0d010c020b200821032002450d010b41f880041035000b200020093703082000200a37030020002007370310200020033703180b0500101d000b0f0020002001102641ff01714101460b4b01017f200141016a2102024020012d00004101460d0020002002290000370000200041106a200241106a280000360000200041086a200241086a2900003700000f0b20022d0000103c000b2f01017f230041206b22002400200041106a10232000200028021020002802181040200028020020002802081024000bc02203057f077e067f230041d0036b2203240002400240024002400240024002400240024002400240200241034d0d000240024002400240024002400240200128000022044118742004410874418080fc07717220044108764180fe037120044118767272220441c8f8add902460d000240024002400240200441e0d7f0b779460d002004418ca5c9997b460d032002417c6a2102200141046a21012004419fc0d2d67b460d02200441c8d9aef57b460d05200441b6b6c2e07c460d060240200441b5e89bda7e460d00200441b1d5a255460d022004418fd784b178470d0d200341b0036a1022200341f0016a41186a22044200370300200341f0016a41106a22054200370300200341f0016a41086a22064200370300200342003703f001200341b0036a200341f0016a103d0d0e200320023602f402200320013602f002200341003602f802200341f0016a200341f0026a103720034190036a200341f0016a103e200341f0016a20034190036a100d200341d0026a200341f0016a100a200341b0036a200341d0026a100e20034190036a101b2004200341b0036a41186a2903003703002005200341b0036a41106a2903003703002006200341b0036a41086a290300370300200320032903b0033703f00120034190036a200341f0016a1038200420034190036a41186a280200360200200520034190036a41106a290300370300200620034190036a41086a29030037030020032003290390033703f0012000200341f0016a101c0c0b0b200341b0036a1022200341f0016a41186a22044200370300200341f0016a41106a22014200370300200341f0016a41086a22024200370300200342003703f001200341b0036a200341f0016a103d0d0e200341f0016a1021200341b0036a200341f0016a100c20034190036a101b2004200341b0036a41186a2903003703002001200341b0036a41106a2903003703002002200341b0036a41086a290300370300200320032903b0033703f00120034190036a200341f0016a1038200420034190036a41186a280200360200200120034190036a41106a290300370300200220034190036a41086a29030037030020032003290390033703f0012000200341f0016a101c0c0a0b200341b0036a1022200341f0016a41186a22044200370300200341f0016a41106a22014200370300200341f0016a41086a22024200370300200342003703f001200341b0036a200341f0016a103d0d0e200442003703002001420037030020024200370300200342003703f001200341d0026a200341f0016a100a200341b0036a41186a2205200341d0026a41186a290000370300200341b0036a41106a2206200341d0026a41106a290000370300200341b0036a41086a2207200341d0026a41086a290000370300200320032900d0023703b00320034190036a101b200420052903003703002001200629030037030020022007290300370300200320032903b0033703f00120034190036a200341f0016a1039200420034190036a41186a280200360200200120034190036a41106a290300370300200220034190036a41086a29030037030020032003290390033703f0012000200341f0016a101c0c090b200341b0036a1022200341f0016a41186a22044200370300200341f0016a41106a22014200370300200341f0016a41086a22024200370300200342003703f001200341b0036a200341f0016a103d0d0e200341f0016a1021200341b0036a200341f0016a100f20034190036a101b2004200341b0036a41186a2903003703002001200341b0036a41106a2903003703002002200341b0036a41086a290300370300200320032903b0033703f00120034190036a200341f0016a1039200420034190036a41186a280200360200200120034190036a41106a290300370300200220034190036a41086a29030037030020032003290390033703f0012000200341f0016a101c0c080b200320023602642003200136026020034100360268200341f0016a200341e0006a1036200341a0016a200341f0016a104120034180016a1021200341f0026a20034180016a100c200341b0036a41186a200341f0026a41186a290300370300200341b0036a41106a200341f0026a41106a290300370300200341b0036a41086a200341f0026a41086a290300370300200320032903f0023703b003200341f0016a41186a2204200341a0016a41186a290300370300200341f0016a41106a2201200341a0016a41106a290300370300200341f0016a41086a2202200341a0016a41086a290300370300200320032903a0013703f00120034190036a200341b0036a200341f0016a103b200341b0036a20034180016a100d200420034190036a41186a290300370300200120034190036a41106a290300370300200220034190036a41086a29030037030020032003290390033703f001200341d0026a200341f0016a103a200341b0036a200341d0026a100720004100360208200042013702000c070b200341b0036a1022200341f0016a41186a22044200370300200341f0016a41106a22014200370300200341f0016a41086a22024200370300200342003703f001200341b0036a200341f0016a103d0d0d2004420037000020034181026a4200370000200341f9016a4200370000200342003700f101200341013a00f00120034190036a200341f0016a1009200341b0036a20034190036a100c20034190036a101b2004200341b0036a41186a2903003703002001200341b0036a41106a2903003703002002200341b0036a41086a290300370300200320032903b0033703f00120034190036a200341f0016a1038200420034190036a41186a280200360200200120034190036a41106a290300370300200220034190036a41086a29030037030020032003290390033703f0012000200341f0016a101c0c060b200341b0036a1022200341f0016a41186a4200370300200341f0016a41106a22044200370300200341f0016a41086a4200370300200342003703f001200341b0036a200341f0016a103d0d0d200341f0016a41186a2201420037000020034181026a4200370000200341f9016a4200370000200342003700f101200341013a00f001200341d0026a200341f0016a100a200341b0036a41186a2202200341d0026a41186a290000370300200341b0036a41106a2205200341d0026a41106a290000370300200341b0036a41086a2206200341d0026a41086a290000370300200320032900d0023703b00320034190036a101b2001200229030037030020042005290300370300200341f0016a41086a22022006290300370300200320032903b0033703f00120034190036a200341f0016a1039200120034190036a41186a280200360200200420034190036a41106a290300370300200220034190036a41086a29030037030020032003290390033703f0012000200341f0016a101c0c050b200341b0036a102220034188026a2204420037030020034180026a22054200370300200341f8016a22064200370300200342003703f001200341b0036a200341f0016a103d0d0d200320023602042003200136020020034100360208200341f0016a20031037200341106a200341f0016a103e200341f0016a20031037200341286a200341f0016a103e200341f0016a20031036200341c0006a200341f0016a1041200341e0006a200341106a100c20034180016a200341286a100c200442003703002005420037030020064200370300200342003703f001200341c0006a200341f0016a41201043450d03200341e0006a200341c0006a102641ff017141ff01460d03200341286a200341106a41141043450d032003290368220820032903487d220920085621012003290358210a2003290350210b200329037821082003290370210c2003290360220d20032903407d220e200d580d012009427f7c220d20095620016a21010c020b200341b0036a1022200341f0016a41186a22044200370300200341f0016a41106a22014200370300200341f0016a41086a22024200370300200342003703f001200341b0036a200341f0016a103d0d0d200442003703002001420037030020024200370300200342003703f00120034190036a200341f0016a1009200341b0036a20034190036a100c20034190036a101b2004200341b0036a41186a2903003703002001200341b0036a41106a2903003703002002200341b0036a41086a290300370300200320032903b0033703f00120034190036a200341f0016a1038200420034190036a41186a280200360200200120034190036a41106a290300370300200220034190036a41086a29030037030020032003290390033703f0012000200341f0016a101c0c030b2009210d0b200c200b7d2209200c562104024002402001450d0020092001ad7d220b20095620046a21040c010b2009210b0b2008200a7d220c2008562101024002402004450d00200c2004ad7d2208200c5620016a450d010c0e0b200c210820010d0d0b200341b0036a41186a220420034180016a41186a290300370300200341b0036a41106a220120034180016a41106a290300370300200341b0036a41086a220220034180016a41086a29030037030020032003290380013703b003200341f0016a41186a2205200341c0006a41186a220f290300370300200341f0016a41106a2206200341c0006a41106a2210290300370300200341f0016a41086a2207200341c0006a41086a2211290300370300200320032903403703f001200341a0016a200341b0036a200341f0016a103b20034190036a200341106a100d2003200d3703f8012003200e3703f0012003200b370380022003200837038802200341b0036a200341f0016a103a20034190036a200341b0036a100720034190036a200341286a100d2005200341a0016a41186a2903003703002006200341a0016a41106a2903003703002007200341a0016a41086a290300370300200320032903a0013703f001200341b0036a200341f0016a103a20034190036a200341b0036a1007200341c0016a41106a200341106a41106a280200360200200341c0016a41086a200341106a41086a290300370300200320032903103703c001200341d8016a41106a200341286a41106a280200360200200341d8016a41086a200341286a41086a290300370300200320032903283703d801200342aaabaeb99afe98e2a17f3700df0220034296d0d4d7d5a9fd91b37f3700e702200341f0026a41106a221220032900e002370300200341e984c3c5063600d802200341fcef003b00dc022003418d013a00de02200341f0026a41086a221320032900d802370300200341ef013a00ef02200341f0026a41186a221420032900e802370300200342dde5cbeabac3b8e49b7f3700d002200342dde5cbeabac3b8e49b7f3703f00220034190036a200341c0016a101f200341b0036a200341d8016a101f20052014290300370300200620122903003703002007201329030037030020034198026a20034190036a41086a2205290300370300200341a0026a20034190036a41106a2206290300370300200341a8026a20034190036a41186a2207290300370300200341b8026a2002290300370300200341c0026a2001290300370300200341c8026a2004290300370300200320032903f0023703f001200320032903900337039002200320032903b0033703b00220034190036a101b2004200f2903003703002001201029030037030020022011290300370300200320032903403703b00320034190036a200341b0036a103820042007280200360200200120062903003703002002200529030037030020032003290390033703b003200341f0026a200341b0036a101c200341f0016a410320032802f002220420032802f8021008200420032802f402101a0b20004100360208200042013702000b200341d0036a24000f0b419081041035000b41a881041035000b41c081041035000b41c081041035000b41c081041035000b41c081041035000b41c081041035000b41c081041035000b41c081041035000b41c081041035000b41f880041035000b5500024020012d00004101460d00200041186a200141206a290300370300200041106a200141186a290300370300200041086a200141106a2903003703002000200141086a2903003703000f0b20012d0001103c000b3001017f410021030240034020022003460d01200020036a200120036a2d00003a0000200341016a21030c000b0b20000b4801047f410021034100210402400340200420024f0d01200120046a2105200020046a2106200441016a210420062d0000220620052d00002205460d000b200620056b21030b20030b0bff0c0300418080040bd801d800010020000000f800010062000000d3070000090000000100000000000000010000000200000003000000040000000500000004000000040000000600000007000000080000000900000000000000010000000200000003000000040000005a010100110000006b01010013000000f5020000050000007e0101001d0000009b0101005d000000290000000200000050020100120000002e0201000a000000340000000200000038020100180000002e0201000a0000003400000002000000f8010100360000002e0201000a00000034000000020000000041d881040b8a03617373657274696f6e206661696c65643a2038203c3d206275662e6c656e28292f55736572732f6e6f61682d76696e63656e7a6e6f65682f2e636172676f2f72656769737472792f7372632f6769746875622e636f6d2d316563633632393964623965633832332f627974656f726465722d312e332e302f7372632f6c69622e72736361706163697479206f766572666c6f776c6962616c6c6f632f7261775f7665632e727361726974686d65746963206f7065726174696f6e206f766572666c6f772f55736572732f6e6f61682d76696e63656e7a6e6f65682f2e636172676f2f72656769737472792f7372632f6769746875622e636f6d2d316563633632393964623965633832332f75696e742d302e352e302f7372632f6c69622e7273556e61626c6520746f206163636570742076616c756520696e206e6f6e2d70617961626c6520636f6e7374727563746f722063616c6c7372632f6c69622e7273496e76616c6964206d6574686f64207369676e6174757265496e76616c69642061626920696e766f6b650041e484040b84080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000';
exports.CODE_HEX = CODE_HEX;

},{}],4:[function(require,module,exports){
(function (global){
"use strict";

var _stringmanipulation = require("./stringmanipulation.mjs");

var _contract = require("./contract.mjs");

var _deploy = require("./deploy/deploy.mjs");

var _oracles = require("./oracles.mjs");

function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _nonIterableRest(); }

function _nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance"); }

function _iterableToArrayLimit(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i["return"] != null) _i["return"](); } finally { if (_d) throw _e; } } return _arr; }

function _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }

//TODO: add window for user to add definitions by typing 'c1 = give zero' then whenever parsing through string we replace every c1 with its value in the map
//TODO: add gas estimation of transfers
//TODO: go over conditionalEvaluation to check if correct for all cases
var numberOfSubContracts = 0;
var numberOfContracts = 0;
var stringToAddToBeginning = ""; // string that is added to the beginning of the contract when outer most does not contain any conjunctions ie. 'truncate' will simply be added to contract string and rest will be decomposed

var superContractsMap = new Map(); // map from superContract id to set of contract objects contained within super contract

var agreedOracleAddress;
var account1Deposited = false;
var account2Deposited = false;
var definitionsMap = new Map();
$(function () {
  var $select = $(".custom_select");

  for (var i = 1; i <= 100; ++i) {
    $select.append($('<option></option>').val(i).html(i));
  }
});
window.addEventListener('load', function () {
  // commented for testing purposes

  /*
    document.getElementById("deposit_button1").disabled = true;
    document.getElementById("deposit_button2").disabled = true;
    document.getElementById("make_transaction_button").disabled = true;
    document.getElementById("select_deposit").disabled = true;
    document.getElementById("transaction_input_textarea").disabled = true;
    */
  (0, _oracles.createOracles)(); // start timer

  update();
  runClock();
}); // TODO: transform input ie decrease spaces

global.addDefinition = function (inputString) {
  document.getElementById("add_definitions_status").innerHTML = ""; // pattern matching for semantics

  var matches = inputString.match(/^\w+\s=\s.+;$/);

  if (matches === null) {
    document.getElementById("add_definitions_status").innerHTML = "The format of the given definition is incorrect.";
    return;
  }

  document.getElementById("input_added_textarea").innerHTML = "";
  var strArr = inputString.split("=");
  var part1 = (0, _stringmanipulation.rTrimWhiteSpace)(strArr[0]);
  var part2 = (0, _stringmanipulation.trimSemiColon)((0, _stringmanipulation.lTrimWhiteSpace)(strArr[1])); // check semantics of second part

  var secondArr = part2.split(" ");

  for (var i = 0; i < secondArr.length; ++i) {
    var term = secondArr[i];

    if (term !== "give" && term !== "truncate" && term !== "get" && term !== "one" && term !== "zero" && term !== "scaleK" && term !== "one" && term !== "{==}" && term !== "{>=}" && term !== "{<=}" && term !== "{<}" && term !== "{>}" && term !== "[==]" && term !== "[>=]" && term !== "[<=]" && term !== "[<]" && term !== "[>]" && term !== "&&" && term !== "||" && !parseInt(term) && !isDate((0, _stringmanipulation.lTrimDoubleQuotes)((0, _stringmanipulation.rTrimDoubleQuotes)(term))) && term !== "else" && term !== "}" && term !== "{" && term !== "and" && term !== "or" && term !== "libor3m" && term !== "tempInLondon" && !definitionsMap.has(term)) {
      document.getElementById("add_definitions_status").innerHTML = "The format of the given definition is incorrect.";
      return;
    }
  }

  definitionsMap.set(part1, part2);
  var _iteratorNormalCompletion = true;
  var _didIteratorError = false;
  var _iteratorError = undefined;

  try {
    for (var _iterator = definitionsMap[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
      var _step$value = _slicedToArray(_step.value, 2),
          key = _step$value[0],
          value = _step$value[1];

      document.getElementById("input_added_textarea").innerHTML += key + " = " + value + "\n";
    }
  } catch (err) {
    _didIteratorError = true;
    _iteratorError = err;
  } finally {
    try {
      if (!_iteratorNormalCompletion && _iterator["return"] != null) {
        _iterator["return"]();
      }
    } finally {
      if (_didIteratorError) {
        throw _iteratorError;
      }
    }
  }
};

global.getDefinitionsText = function () {
  return document.getElementById("add_input_textarea").value;
};

function update() {
  // loop through all contracts and check if their time == current time and if so check if get or not
  // if get: then execute
  // if not get: then disable acquire button
  var _iteratorNormalCompletion2 = true;
  var _didIteratorError2 = false;
  var _iteratorError2 = undefined;

  try {
    for (var _iterator2 = superContractsMap[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {
      var _step2$value = _slicedToArray(_step2.value, 2),
          superContractId = _step2$value[0],
          contractsSet = _step2$value[1];

      var _iteratorNormalCompletion3 = true;
      var _didIteratorError3 = false;
      var _iteratorError3 = undefined;

      try {
        for (var _iterator3 = contractsSet[Symbol.iterator](), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {
          var contract = _step3.value;

          if (contract.horizonDate !== "infinite" && beforeCurrentDate(contract.horizonDate)) {
            if (contract.toBeExecutedAtHorizon === "yes") {
              // contract contains 'get' - must be executed now
              executeSingleContract(contract);
            } else {
              // contract just contains 'truncate' and not 'get'
              document.getElementById("td_status_" + contract.id).innerHTML = "expired";
              deleteFromSuperContracts(superContractId, contract);
              console.log("Contract " + contract.id + " has expired.");
              checkForEmptySuperContract();
            }
          }
        }
      } catch (err) {
        _didIteratorError3 = true;
        _iteratorError3 = err;
      } finally {
        try {
          if (!_iteratorNormalCompletion3 && _iterator3["return"] != null) {
            _iterator3["return"]();
          }
        } finally {
          if (_didIteratorError3) {
            throw _iteratorError3;
          }
        }
      }
    }
  } catch (err) {
    _didIteratorError2 = true;
    _iteratorError2 = err;
  } finally {
    try {
      if (!_iteratorNormalCompletion2 && _iterator2["return"] != null) {
        _iterator2["return"]();
      }
    } finally {
      if (_didIteratorError2) {
        throw _iteratorError2;
      }
    }
  }
}

function runClock() {
  var now = new Date();
  var timeToNextTick = (60 - now.getSeconds()) * 1000 - now.getMilliseconds();
  setTimeout(function () {
    update();
    runClock();
  }, timeToNextTick);
}

function updateBalances() {
  retrieveBalances();
}

global.callDepositFunction = function (id) {
  document.getElementById("create_contract_status").innerHTML = "";
  var addr = "";

  if (id === 1) {
    addr = "holder_address";
  } else {
    addr = "counter_party_address";
  }

  var depositAmount = getSelectedDeposit();
  var senderAddress = document.getElementById(addr).value;

  if ((0, _deploy.getSelectedMetaMaskAccount)().toUpperCase() === senderAddress.toUpperCase()) {
    (0, _deploy.depositCollateral)(senderAddress, depositAmount).then(function (holderDepositTxHash) {
      (0, _deploy.waitForReceipt)(holderDepositTxHash).then(function (_) {
        console.log("Deposit of " + depositAmount + " Ether has been added to " + addr + " account.");
        document.getElementById("select_deposit").disabled = true;

        if (id === 1) {
          account1Deposited = true;
        } else {
          account2Deposited = true;
        }

        if (account1Deposited && account2Deposited) {
          document.getElementById("make_transaction_button").disabled = false;
        }

        retrieveBalances();
      });
    });
  } else {
    document.getElementById("create_contract_status").innerHTML = "Please change the currently selected MetaMask account to the one you would like to deposit to.";
  }
};

global.createContractFunction = function () {
  document.getElementById("create_contract_status").innerHTML = "";
  var holderAddressValue = document.getElementById("holder_address").value;
  var counterPartyAddressValue = document.getElementById("counter_party_address").value;

  if ((0, _deploy.getSelectedMetaMaskAccount)().toUpperCase() === holderAddressValue.toUpperCase()) {
    (0, _deploy.setDefaultAccount)(holderAddressValue);
    (0, _deploy.instantiateNew)(holderAddressValue, counterPartyAddressValue).then(function (instantiationTxHash) {
      (0, _deploy.waitForReceipt)(instantiationTxHash).then(function (instantiationReceipt) {
        (0, _deploy.setSmartContractInstance)(instantiationReceipt.contractAddress);
        document.getElementById("create_contract_button").disabled = true;
        document.getElementById("select_oracle").disabled = true;
        document.getElementById("holder_address").disabled = true;
        document.getElementById("counter_party_address").disabled = true;
        document.getElementById("deposit_button1").disabled = false;
        document.getElementById("deposit_button2").disabled = false;
        document.getElementById("select_deposit").disabled = false;
        agreedOracleAddress = getSelectedOracle();
      });
    });
  } else {
    document.getElementById("create_contract_status").innerHTML = "Please change the currently selected MetaMask account to the contract holder account.";
  }
};

function getSelectedDeposit() {
  return document.getElementById("select_deposit").value;
}

function getSelectedOracle() {
  return document.getElementById("select_oracle").value;
}

global.getInputString = function () {
  return document.getElementById("transaction_input_textarea").value;
}; // split string into '(...)', '{...}', '{...}' (if contains else)
// split by outermost comparison operator
// find horizon of each contract - check if date is later
// replace if clause by contract either {true} or {false} contract


function evaluateConditionals(inputString) {
  var openingParens = 0;
  var closingParens = 0;
  var stack = [];
  var ifsStack = []; // keeping stack of leftover opening parenthesis in from previous ifs

  var ifCondition = "";
  var ifsToBeMatched = 0; // keeps track of how many ifs have been read ie. how nested clause is

  var termArr = inputString.split(" ");

  for (var i = 0; i < termArr.length; ++i) {
    var term = termArr[i];
    var nextTerm = termArr[i + 1]; // for syntax checking

    stack.push(term);

    if (term === "if") {
      if (i >= termArr.length - 3 || nextTerm !== "(") {
        document.getElementById("transaction_status").innerHTML = "syntax error at term " + (i + 1).toString() + ": " + nextTerm;
        return "error";
      }

      ++ifsToBeMatched;
      ifsStack.push(openingParens - closingParens);
    } else if (term === "(") {
      if (i >= termArr.length - 3 || nextTerm === ")" || nextTerm === "{>}" || nextTerm === "{<}" || nextTerm === "{>=}" || nextTerm === "{<=}" || nextTerm === "{==}" || nextTerm === "[>]" || nextTerm === "[<]" || nextTerm === "[>=]" || nextTerm === "[<=]" || nextTerm === "[==]" || nextTerm === "{&&}" || nextTerm === "||" || nextTerm === "{" || nextTerm === "}") {
        document.getElementById("transaction_status").innerHTML = "syntax error at term " + (i + 1).toString() + ": " + nextTerm;
        return "error";
      }

      ++openingParens;
    } else if (term === ")") {
      if (i < termArr.length - 1 && (nextTerm === "if" || nextTerm === "(" || nextTerm === "}")) {
        document.getElementById("transaction_status").innerHTML = "syntax error at term " + (i + 1).toString() + ": " + nextTerm;
        return "error";
      }

      ++closingParens;

      if (ifsStack.length === 0 && openingParens === closingParens && ifsToBeMatched !== 0 || openingParens - ifsStack[ifsStack.length - 1] === closingParens) {
        // pop from stack until we have read 'if'
        while (stack[stack.length - 1] !== "if") {
          if (ifCondition === "") {
            ifCondition = stack.pop();
          } else {
            ifCondition = stack.pop() + " " + ifCondition;
          }
        }

        console.log("if condition: " + ifCondition);
        stack.pop(); // popping 'if' off stack

        --ifsToBeMatched; // performance is good here: not parsing {}{} stuff

        var leftOverArr = termArr.slice(i + 1);
        var firstIndexClosingBrack = leftOverArr.indexOf("}");
        var action1Arr = leftOverArr.slice(1, firstIndexClosingBrack);
        var action1 = action1Arr.join(" ");
        console.log("action1: " + action1);
        var action2Arr = [];
        var action2 = "";

        if (leftOverArr[firstIndexClosingBrack + 1] === "else") {
          leftOverArr = leftOverArr.slice(firstIndexClosingBrack + 2); // + 2 because of 'else'

          firstIndexClosingBrack = leftOverArr.indexOf("}");
          action2Arr = leftOverArr.slice(1, firstIndexClosingBrack);
          action2 = action2Arr.join(" ");
        }

        console.log("action2: " + action2);
        var bool = evaluate((0, _stringmanipulation.rTrimWhiteSpace)((0, _stringmanipulation.lTrimWhiteSpace)((0, _stringmanipulation.rTrimParen)((0, _stringmanipulation.lTrimParen)(ifCondition)))));
        console.log("bool: " + bool);

        if (stack[stack.length - 1] === "(" && leftOverArr[firstIndexClosingBrack + 1] === ")") {
          stack.pop(); // get rid of previous '('

          ++i; // skip next previous ')'

          leftOverArr.splice(firstIndexClosingBrack + 1, 1); // for check in action=="" part

          ++closingParens;
        }

        if (bool) {
          // if the if clause succeeds then execute action1
          stack.push((0, _stringmanipulation.lTrimBrace)((0, _stringmanipulation.rTrimBrace)(action1)));
        } else {
          if (action2 == "") {
            if (stack[stack.length - 1] === "and" || stack[stack.length - 1] === "or") {
              stack.pop();
            }

            if (leftOverArr[firstIndexClosingBrack + 1] === "and" || leftOverArr[firstIndexClosingBrack + 1] === "or") {
              ++i;
            }
          }

          stack.push((0, _stringmanipulation.lTrimBrace)((0, _stringmanipulation.rTrimBrace)(action2)));
        }

        console.log("stack:");
        console.log(stack); // skip next terms until end of conditional clause is reached

        i = i + action1Arr.length + 2;

        if (action2Arr.length !== 0) {
          i = i + 1 + action2Arr.length + 2;
        }
      }

      ifsStack.pop();
      ifCondition = "";
    } else if (term !== "give" && term !== "truncate" && term !== "get" && term !== "one" && term !== "zero" && term !== "scaleK" && term !== "one" && term !== "{==}" && term !== "{>=}" && term !== "{<=}" && term !== "{<}" && term !== "{>}" && term !== "[==]" && term !== "[>=]" && term !== "[<=]" && term !== "[<]" && term !== "[>]" && term !== "&&" && term !== "||" && !parseInt(term) && !isDate((0, _stringmanipulation.lTrimDoubleQuotes)((0, _stringmanipulation.rTrimDoubleQuotes)(term))) && term !== "else" && term !== "}" && term !== "{" && term !== "and" && term !== "or" && term !== "libor3m" && term !== "tempInLondon") {
      // give error
      document.getElementById("transaction_status").innerHTML = "syntax error at term " + i.toString() + ": " + term;
      return "error";
    }
  }

  var contractString = "";

  while (stack.length !== 0) {
    contractString = stack.pop() + " " + contractString;
  }

  return (0, _stringmanipulation.lTrimWhiteSpace)((0, _stringmanipulation.rTrimWhiteSpace)(contractString));
}

function evaluate(inputString) {
  var strArr = inputString.split(" ");
  var openingParens = 0;

  for (var i = 0; i < strArr.length; ++i) {
    var term = strArr[i];

    if (term === "(") {
      ++openingParens;
    } else if (term === ")") {
      --openingParens;
    } else if (openingParens === 0) {
      if (term === "||" || term === "&&") {
        var part1 = strArr.slice(0, i).join(" ");
        var part2 = strArr.slice(i + 1).join(" ");
        var bool1 = evaluate((0, _stringmanipulation.lTrimWhiteSpace)((0, _stringmanipulation.rTrimWhiteSpace)((0, _stringmanipulation.lTrimParen)((0, _stringmanipulation.rTrimParen)(part1)))));
        var bool2 = evaluate((0, _stringmanipulation.lTrimWhiteSpace)((0, _stringmanipulation.rTrimWhiteSpace)((0, _stringmanipulation.lTrimParen)((0, _stringmanipulation.rTrimParen)(part2)))));

        if (term === "||") {
          return bool1 || bool2;
        } else if (term === "&&") {
          return bool1 && bool2;
        }
      } else if (term === "{>}" || term === "{<}" || term === "{==}" || term === "{>=}" || term === "{<=}") {
        // Horizon Comparison
        // can only compare two contracts - cannot have a logical operator between two contracts
        // if no truncate included then horizon is infinite, else find max date
        var part1 = strArr.slice(0, i).join(" ");
        var part2 = strArr.slice(i + 1).join(" ");
        var horizon1 = getHorizon(part1);
        var horizon2 = getHorizon(part2);

        if (term === "{>=}") {
          if (horizon1 === "infinite" || horizon2 === "infinite") {
            if (horizon1 === "infinite" && horizon2 === "infinite") {
              return true;
            } else {
              if (horizon1 === "infinite") {
                return true;
              } else {
                return false;
              }
            }
          }

          return greaterDate(horizon1, horizon2) || equalDates(horizon1, horizon2);
        } else if (term === "{>}") {
          if (horizon1 === "infinite" || horizon2 === "infinite") {
            if (horizon1 === "infinite" && horizon2 === "infinite") {
              return false;
            } else {
              if (horizon1 === "infinite") {
                return true;
              } else {
                return false;
              }
            }
          }

          return greaterDate(horizon1, horizon2);
        } else if (term === "{<=}") {
          if (horizon1 === "infinite" || horizon2 === "infinite") {
            if (horizon1 === "infinite" && horizon2 === "infinite") {
              return true;
            } else {
              if (horizon1 === "infinite") {
                return false;
              } else {
                return true;
              }
            }
          }

          return !greaterDate(horizon1, horizon2) || equalDates(horizon1, horizon2);
        } else if (term === "{<}") {
          if (horizon1 === "infinite" || horizon2 === "infinite") {
            if (horizon1 === "infinite" && horizon2 === "infinite") {
              return false;
            } else {
              if (horizon1 === "infinite") {
                return false;
              } else {
                return true;
              }
            }
          }

          return !greaterDate(horizon1, horizon2);
        } else if (term === "{==}") {
          if (horizon1 === "infinite" || horizon2 === "infinite") {
            if (horizon1 === "infinite" && horizon2 === "infinite") {
              return true;
            } else {
              return false;
            }
          }

          return equalDates(horizon1, horizon2);
        }
      } else if (term === "[>]" || term === "[<]" || term === "[==]" || term === "[>=]" || term === "[<=]") {
        // Value Comparison
        // can only compare two contracts - so we cannot have (a & b) > (c | d), cannot have  a & b or  a | b
        var part1 = strArr.slice(0, i).join(" ");
        var part2 = strArr.slice(i + 1).join(" ");
        var value1 = getValue(part1);
        var value2 = getValue(part2);

        if (term === "[>=]") {
          return value1 >= value2;
        } else if (term === "[>]") {
          return value1 > value2;
        } else if (term === "[<=]") {
          return value1 <= value2;
        } else if (term === "[<]") {
          return value1 < value2;
        } else if (term === "[==]") {
          return value1 === value2;
        }
      }
    }
  }
}

function getHorizon(contractString) {
  // Loops through the whole contract to find the largest horizon
  if (!contractString.includes("truncate")) {
    return "infinite";
  } else {
    // Find minimum horizon, but beforeCurrentDate() must return false
    var strArr = contractString.split(" ");
    var indexOfFirstTruncate = strArr.indexOf("truncate");
    var substringArr = strArr.slice(indexOfFirstTruncate + 1);
    var maxHorizon = substringArr[0]; // setting first horizon as maxHorizon

    var comeAcrossTruncate = false;

    for (var i = 0; i < strArr.length; ++i) {
      if (strArr[i] === "truncate") {
        // obtain c from 'truncate t c'
        var truncDate = strArr[i + 1];
        var c = obtainContractString(strArr.slice(i + 2)); // obtain c's previous horizon

        var prevHorizon = getHorizon(c); // compare previous horizon with new horizon t and get min

        var currentHor = truncDate;

        if (prevHorizon !== "infinite" && greaterDate(truncDate, prevHorizon)) {
          currentHor = prevHorizon;
        }

        comeAcrossTruncate = true;

        if (greaterDate(currentHor, maxHorizon)) {
          maxHorizon = currentHor;
        }

        ++i;
      } else if (strArr[i] === "and" || strArr[i] === "or") {
        // have reached end of subcontract
        if (!comeAcrossTruncate) {
          // if we have not come across a "truncate" then this subcontract's horizon is infinite
          return "infinite";
        }

        comeAcrossTruncate = false;
      }
    }

    return maxHorizon;
  }
}

function getValue(contractString) {
  var strArr = contractString.split(" "); // check if string contains conjunction

  if (contractString.includes("and") || contractString.includes("or")) {
    // find most balanced conjunction
    var indexOfMostBalancedConj = 0;
    var mostBalancedConjType = "";
    var mostBalancedConjBalance = strArr.length;
    var openingParens = 0;

    for (var i = 0; i < strArr.length; ++i) {
      if (strArr[i] === "(") {
        ++openingParens;
      } else if (strArr[i] === ")") {
        --openingParens;
      } else if (strArr[i] === "and" || strArr[i] === "or") {
        if (openingParens < mostBalancedConjBalance) {
          indexOfMostBalancedConj = i;
          mostBalancedConjType = strArr[i];
          mostBalancedConjBalance = openingParens;
        }
      }
    } // split contract by mostBalanced conj and perform getValue and getHorizon on both parts


    var part1 = strArr.slice(0, indexOfMostBalancedConj).join(" ");
    var part2 = strArr.slice(indexOfMostBalancedConj + 1).join(" ");
    var horizon1 = getHorizon(part1);
    var horizon2 = getHorizon(part2);
    var value1 = getValue(part1);
    var value2 = getValue(part2);

    if (!beforeCurrentDate((0, _stringmanipulation.lTrimDoubleQuotes)((0, _stringmanipulation.rTrimDoubleQuotes)(horizon1))) && !beforeCurrentDate((0, _stringmanipulation.lTrimDoubleQuotes)((0, _stringmanipulation.rTrimDoubleQuotes)(horizon2)))) {
      if (mostBalancedConjType === "and") {
        return value1 + value2;
      } else {
        return Math.max(value1, value2);
      }
    } else if (!beforeCurrentDate((0, _stringmanipulation.lTrimDoubleQuotes)((0, _stringmanipulation.rTrimDoubleQuotes)(horizon1))) && beforeCurrentDate((0, _stringmanipulation.lTrimDoubleQuotes)((0, _stringmanipulation.rTrimDoubleQuotes)(horizon2)))) {
      return value1;
    } else if (beforeCurrentDate((0, _stringmanipulation.lTrimDoubleQuotes)((0, _stringmanipulation.rTrimDoubleQuotes)(horizon1))) && !beforeCurrentDate((0, _stringmanipulation.lTrimDoubleQuotes)((0, _stringmanipulation.rTrimDoubleQuotes)(horizon2)))) {
      return value2;
    } else {
      // both have expired - return 0
      return 0;
    }
  } else {
    // string does not contain conjunction
    var value = 1;

    if (contractString.includes("zero")) {
      return 0;
    } else {
      for (var i = 0; i < strArr.length; ++i) {
        if (strArr[i] === "scaleK" && i < strArr.length - 2 && parseFloat(strArr[i + 1])) {
          value = value * parseFloat(strArr[i + 1]);
        } else if (strArr[i] === "give") {
          value = -value;
        }
      }

      if (beforeCurrentDate((0, _stringmanipulation.lTrimDoubleQuotes)((0, _stringmanipulation.rTrimDoubleQuotes)(getHorizon(contractString))))) {
        return 0;
      } else {
        return value;
      }
    }
  }
}

function obtainContractString(array) {
  // if string starts with opening paren wait until get balanced closing paren
  if (array[0] === "(") {
    var openingParens = 1;

    for (var i = 1; i < array.length; ++i) {
      if (array[i] === "(") {
        ++openingParens;
      } else if (array[i] === ")") {
        --openingParens;
      }

      if (openingParens === 0) {
        return array.slice(0, i + 1).join(' ');
      }
    }
  } else {
    // else wait until reading 'zero' or 'one'
    for (var i = 0; i < array.length; ++i) {
      if (array[i] === "one" || array[i] === "zero") {
        return array.slice(0, i + 1).join(' ');
      }
    }
  }
} // TODO: add syntax checking to this method


global.decomposeContract = function (inputString) {
  document.getElementById("transaction_status").innerHTML = "";

  if (inputString === "") {
    document.getElementById("transaction_status").innerHTML = "Please provide some contract input.";
    return;
  }

  if ((0, _stringmanipulation.openingParensAmount)(inputString) !== (0, _stringmanipulation.closingParensAmount)(inputString)) {
    document.getElementById("transaction_status").innerHTML = "Parenthesis mismatch: The contract is not constructed properly.";
    return;
  } // replacing own definitions with map values


  var strSplit = inputString.split(" ");
  var keys = Array.from(definitionsMap.keys());
  var intersection = strSplit.filter(function (value) {
    return keys.includes(value);
  });

  while (intersection.length !== 0) {
    for (var i = 0; i < intersection.length; ++i) {
      var regex = new RegExp("(.*)(" + intersection[i] + ")(.*)");
      var matchObj = regex.exec(inputString);
      var value = definitionsMap.get(intersection[i]);

      if (value.indexOf("one") !== value.lastIndexOf("one") || value.indexOf("zero") !== value.lastIndexOf("zero") || value.includes("one") && value.includes("zero")) {
        // value consists of multiple contracts - add parenthesis
        inputString = matchObj[1] + "( " + definitionsMap.get(intersection[i]) + " )" + matchObj[3];
      } else {
        inputString = matchObj[1] + definitionsMap.get(intersection[i]) + matchObj[3];
      }
    }

    strSplit = inputString.split(" ");
    intersection = strSplit.filter(function (value) {
      return keys.includes(value);
    });
  }

  inputString = (0, _stringmanipulation.changeDateFormat)(inputString); // remove linebreaks

  inputString = inputString.replace(/(\r\n|\n|\r)/gm, " "); // remove multiple whitespaces

  inputString = inputString.replace(/  +/g, ' '); // add spacing before and after parenthesis

  inputString = (0, _stringmanipulation.addSpacing)(inputString); // repeat replacing the if clause while string includes if

  var ifMatches = inputString.match(/^(.*)\sif\s(.*)$/);

  if (ifMatches !== null) {
    inputString = evaluateConditionals(inputString);
  }

  if (inputString === "" || inputString === "error") {
    return;
  }

  inputString = (0, _stringmanipulation.rTrimWhiteSpace)((0, _stringmanipulation.lTrimWhiteSpace)(inputString));

  if (inputString.includes("get") && !inputString.includes("truncate")) {
    document.getElementById("transaction_status").innerHTML = "The contract is not constructed properly. A contract cannot contain 'get' without 'truncate'.";
    return;
  }

  removeChildren("button_choices_container");
  var noOfOpeningParens = 0;
  var noOfClosingParens = 0;
  var contractsStack = [];
  stringToAddToBeginning = ""; // check if inputstring contains 'or' else execute right away

  var orMatches = inputString.match(/^(.*)\sor\s(.*)$/);

  if (orMatches !== null) {
    var firstOpeningParenOcc = inputString.indexOf("(");
    var firstSubstring = inputString.slice(0, firstOpeningParenOcc);

    if (!firstSubstring.includes("or")) {
      inputString = inputString.slice(firstOpeningParenOcc, inputString.length);
      stringToAddToBeginning = firstSubstring;
    }

    var strArr = inputString.split(" ");
    var indexOfMostBalancedOr = strArr.length - 1;
    var mostBalancedOr = strArr.length - 1;

    for (var i = 0; i < strArr.length; ++i) {
      var term = strArr[i];

      if (term === "or") {
        if (noOfOpeningParens === noOfClosingParens) {
          // found outer most conjunct
          contractsStack.push(strArr.slice(0, i).join(' '));
          contractsStack.push(strArr.slice(i + 1).join(' '));
          break;
        } else if (noOfOpeningParens > noOfClosingParens) {
          if (noOfOpeningParens - noOfClosingParens < mostBalancedOr) {
            mostBalancedOr = noOfOpeningParens - noOfClosingParens;
            indexOfMostBalancedOr = i;
          }
        }
      } else {
        if (term === "(") {
          ++noOfOpeningParens;
        } else if (term === ")") {
          ++noOfClosingParens;

          if (i === strArr.length - 1) {
            contractsStack.push(inputString);
          }
        }
      }

      if (noOfClosingParens > noOfOpeningParens) {
        document.getElementById("transaction_status").innerHTML = "Parenthesis mismatch: The contract is not constructed properly.";
        return;
      }
    }

    if (contractsStack.length === 1 && contractsStack[0].includes("or")) {
      contractsStack = splitContract(strArr, indexOfMostBalancedOr);
    }

    combineContracts(contractsStack);
  } else {
    // String does not include "or" -> execute right away
    var firstOpeningParenOcc = inputString.indexOf("(");
    var firstSubstring = inputString.slice(0, firstOpeningParenOcc);

    if (!firstSubstring.includes("and")) {
      inputString = inputString.slice(firstOpeningParenOcc, inputString.length);
      stringToAddToBeginning = firstSubstring;
    }

    var outputStrings = inputString.split("and");
    var acquireBtnToBeDisabled1 = true;
    var acquireBtnToBeDisabled2 = true; // acquire button should be disabled if either all contracts are expired or all contracts are to be acquired at horizon ie 'get'

    for (var i = 0; i < outputStrings.length; ++i) {
      var conString = stringToAddToBeginning + (0, _stringmanipulation.cleanParens)((0, _stringmanipulation.lTrimWhiteSpace)((0, _stringmanipulation.rTrimWhiteSpace)(outputStrings[i])));

      if (!conString.includes("get")) {
        // at least one contract is not acquired at its horizon
        acquireBtnToBeDisabled1 = false;
      }

      if (!beforeCurrentDate(getHorizon(conString))) {
        // at least one subcontract has not expired yet
        acquireBtnToBeDisabled2 = false;
      }

      createContractObject(conString);
    }

    var table = document.getElementById("my_table");
    var tr = table.insertRow(1);
    tr.className = "super_contract_row";
    var td;
    tr.appendChild(td = document.createElement("td"));
    var superContractKey = numberOfContracts.toString();
    td.innerHTML = superContractKey;

    for (var i = 0; i < 6; ++i) {
      tr.appendChild(td = document.createElement("td"));
    }

    var btn = document.createElement('input');
    btn.type = "button";
    btn.className = "button acquire_button";
    btn.id = "acquire_button_" + superContractKey;
    btn.value = "acquire";

    btn.onclick = function (_) {
      if (correctUserTryingToAcquire()) {
        executeSuperContract(superContractKey);
      } else {
        document.getElementById("table_status").innerHTML = "Please change the currently selected MetaMask account to the one owner of the contract you are trying to acquire.";
      }
    };

    td.appendChild(btn); // if either of these is true then we want the acquire button to be disabled

    if (acquireBtnToBeDisabled1 || acquireBtnToBeDisabled2) {
      btn.disabled = true;
    }

    ++numberOfContracts;
    numberOfSubContracts = 0;
  }
};

function splitContract(contractStringArr, indexOfMostBalancedOr) {
  // do not split by "or" because this will split by first 'or' occurence
  // we want to split by 'or' occurrence with only 1 difference between |openingParens| and |closingParen|
  var newStack = [];
  newStack[0] = (0, _stringmanipulation.cleanParens)(contractStringArr.slice(0, indexOfMostBalancedOr).join(' '));
  newStack[1] = (0, _stringmanipulation.cleanParens)(contractStringArr.slice(indexOfMostBalancedOr + 1, contractStringArr.length - 1).join(' '));

  if ((0, _stringmanipulation.openingParensAmount)(newStack[0]) > (0, _stringmanipulation.closingParensAmount)(newStack[0])) {
    newStack[0] = newStack[0] + " )";
  }

  if ((0, _stringmanipulation.closingParensAmount)(newStack[1]) > (0, _stringmanipulation.openingParensAmount)(newStack[1])) {
    newStack[1] = "( " + newStack[1];
  }

  return newStack;
}

function combineContracts(contractsStack) {
  var contract1 = contractsStack.pop();
  var contract2 = contractsStack.pop();
  createSection();
  createButton((0, _stringmanipulation.rTrimWhiteSpace)((0, _stringmanipulation.lTrimWhiteSpace)(contract2)), 1);
  createOrLabel();
  createButton((0, _stringmanipulation.rTrimWhiteSpace)((0, _stringmanipulation.lTrimWhiteSpace)(contract1)), 2);
}

function createContractObject(inputString) {
  var recipient = 0; // by default the contract holder is the recipient

  var amount = "1";

  if (inputString.includes("zero")) {
    amount = "0";
  }

  var horizonDate = "infinite";
  var acquireAtHorizon = "no"; // used for get, ie if get is discovered then this is set to true

  var newStr = inputString.replace(/[()]/g, ''); // removing parenthesis

  var strArr = newStr.split(" ");

  for (var i = 0; i < strArr.length; ++i) {
    var str = strArr[i];

    if (str === "give") {
      recipient = 1;
    } else if (str === "scaleK" && !inputString.includes("zero")) {
      if (strArr.length > i + 1 && parseInt(strArr[i + 1])) {
        amount = (parseInt(amount) * parseInt(strArr[i + 1])).toString();
        ++i;
      } else if (strArr.length > i + 1 && (strArr[i + 1] === "tempInLondon" || strArr[i + 1] === "libor3m")) {
        amount = strArr[i + 1];
        ++i;
      } else {
        console.error("Syntax error: scaleK should be followed by an integer or an observable.");
        document.getElementById("transaction_status").innerHTML = "Syntax error: scaleK should be followed by an integer or an observable.";
        return;
      }
    } else if (str === "truncate") {
      if (strArr.length > i + 1 && isDate((0, _stringmanipulation.lTrimDoubleQuotes)((0, _stringmanipulation.rTrimDoubleQuotes)(strArr[i + 1])))) {
        horizonDate = strArr[i + 1];
        ++i;
      } else {
        console.error("Syntax error: truncate should be followed by a date in the following pattern: 'dd/mm/yyyy hh:mm:ss'.");
        document.getElementById("transaction_status").innerHTML = "Syntax error: truncate should be followed by a date in the following pattern: 'dd/mm/yyyy hh:mm:ss'.";
        return;
      }
    } else if (str === "get") {
      acquireAtHorizon = "yes";
    }
  }

  horizonDate = (0, _stringmanipulation.lTrimDoubleQuotes)((0, _stringmanipulation.rTrimDoubleQuotes)(horizonDate));
  var contract = new _contract.Contract(numberOfContracts.toString() + "." + numberOfSubContracts.toString(), amount, recipient, inputString, (0, _contract.translateContract)(recipient, amount, horizonDate, acquireAtHorizon), horizonDate, acquireAtHorizon, "waiting to be executed");
  createTableRow(contract);

  if (horizonDate !== "infinite" && beforeCurrentDate(contract.horizonDate)) {
    // add expired label
    document.getElementById("td_status_" + contract.id).innerHTML = "expired";
  } else {
    addToSuperContracts(numberOfContracts.toString(), contract); // contract is only added to pending contracts map if it is still valid

    document.getElementById("td_status_" + contract.id).innerHTML = "waiting to be executed";
  }

  ++numberOfSubContracts;
}

function addToSuperContracts(superKey, contract) {
  if (superContractsMap.has(superKey)) {
    var _iteratorNormalCompletion4 = true;
    var _didIteratorError4 = false;
    var _iteratorError4 = undefined;

    try {
      for (var _iterator4 = superContractsMap[Symbol.iterator](), _step4; !(_iteratorNormalCompletion4 = (_step4 = _iterator4.next()).done); _iteratorNormalCompletion4 = true) {
        var _step4$value = _slicedToArray(_step4.value, 2),
            superContractId = _step4$value[0],
            contractsSet = _step4$value[1];

        if (superContractId === superKey) {
          var newSet = contractsSet;
          newSet.add(contract);
          superContractsMap.set(superContractId, newSet);
          break;
        }
      }
    } catch (err) {
      _didIteratorError4 = true;
      _iteratorError4 = err;
    } finally {
      try {
        if (!_iteratorNormalCompletion4 && _iterator4["return"] != null) {
          _iterator4["return"]();
        }
      } finally {
        if (_didIteratorError4) {
          throw _iteratorError4;
        }
      }
    }
  } else {
    var newSet = new Set();
    newSet.add(contract);
    superContractsMap.set(superKey, newSet);
  }

  console.log("SupercontractsMap after adding a contract");
  console.log(superContractsMap);
}

function deleteFromSuperContracts(superKey, contract) {
  var _iteratorNormalCompletion5 = true;
  var _didIteratorError5 = false;
  var _iteratorError5 = undefined;

  try {
    for (var _iterator5 = superContractsMap[Symbol.iterator](), _step5; !(_iteratorNormalCompletion5 = (_step5 = _iterator5.next()).done); _iteratorNormalCompletion5 = true) {
      var _step5$value = _slicedToArray(_step5.value, 2),
          superContractId = _step5$value[0],
          contractsSet = _step5$value[1];

      if (superContractId === superKey) {
        var newSet = contractsSet;
        newSet["delete"](contract);
        superContractsMap.set(superContractId, newSet);
        break;
      }
    }
  } catch (err) {
    _didIteratorError5 = true;
    _iteratorError5 = err;
  } finally {
    try {
      if (!_iteratorNormalCompletion5 && _iterator5["return"] != null) {
        _iterator5["return"]();
      }
    } finally {
      if (_didIteratorError5) {
        throw _iteratorError5;
      }
    }
  }

  console.log("SupercontractsMap after deleting a contract");
  console.log(superContractsMap);
}

function computeDateString(dateString) {
  var horizonArr = dateString.split("-");
  var dateArr = horizonArr[0].split("/");
  var timeArr = horizonArr[1].split(":"); // +01:00 to get BST from UTC

  var finalDateString = dateArr[2] + "-" + dateArr[1] + "-" + dateArr[0] + "T" + timeArr[0] + ":" + timeArr[1] + ":" + (parseInt(timeArr[2]) + 15).toString() + "+01:00"; // adding 15 seconds to the contract's expiry date to allow it to execute

  return finalDateString;
}

function beforeCurrentDate(contractDate) {
  if (contractDate === "infinite") {
    return false;
  }

  var contractDate = new Date(computeDateString(contractDate));
  var todayDate = new Date();

  if (contractDate.getTime() <= todayDate.getTime()) {
    return true;
  } else {
    return false;
  }
}

function equalDates(dateString1, dateString2) {
  // for first date
  var contractDate1 = new Date(computeDateString(dateString1)); // for second date

  var contractDate2 = new Date(computeDateString(dateString2));

  if (contractDate1.getTime() === contractDate2.getTime()) {
    return true;
  } else {
    return false;
  }
}

function greaterDate(dateString1, dateString2) {
  // returns true if dateString1 > dateString2
  // for first date
  var contractDate1 = new Date(computeDateString(dateString1)); // for second date

  var contractDate2 = new Date(computeDateString(dateString2));

  if (contractDate1.getTime() > contractDate2.getTime()) {
    return true;
  } else {
    return false;
  }
}

function executeSuperContract(superKey) {
  var _iteratorNormalCompletion6 = true;
  var _didIteratorError6 = false;
  var _iteratorError6 = undefined;

  try {
    for (var _iterator6 = superContractsMap[Symbol.iterator](), _step6; !(_iteratorNormalCompletion6 = (_step6 = _iterator6.next()).done); _iteratorNormalCompletion6 = true) {
      var _step6$value = _slicedToArray(_step6.value, 2),
          superContractId = _step6$value[0],
          contractsSet = _step6$value[1];

      if (superContractId === superKey) {
        var _iteratorNormalCompletion7 = true;
        var _didIteratorError7 = false;
        var _iteratorError7 = undefined;

        try {
          for (var _iterator7 = contractsSet[Symbol.iterator](), _step7; !(_iteratorNormalCompletion7 = (_step7 = _iterator7.next()).done); _iteratorNormalCompletion7 = true) {
            var contract = _step7.value;
            executeSingleContract(contract);
          }
        } catch (err) {
          _didIteratorError7 = true;
          _iteratorError7 = err;
        } finally {
          try {
            if (!_iteratorNormalCompletion7 && _iterator7["return"] != null) {
              _iterator7["return"]();
            }
          } finally {
            if (_didIteratorError7) {
              throw _iteratorError7;
            }
          }
        }
      }
    }
  } catch (err) {
    _didIteratorError6 = true;
    _iteratorError6 = err;
  } finally {
    try {
      if (!_iteratorNormalCompletion6 && _iterator6["return"] != null) {
        _iterator6["return"]();
      }
    } finally {
      if (_didIteratorError6) {
        throw _iteratorError6;
      }
    }
  }
}

function executeSingleContract(contract) {
  if (contract.horizonDate !== "infinite") {
    if (beforeCurrentDate(contract.horizonDate)) {
      window.alert("The contract " + contract.id + " has expired.");
      document.getElementById("td_status_" + contract.id).innerHTML = "expired";
      deleteFromSuperContracts(contract.id.split(".")[0], contract);
      checkForEmptySuperContract();
      return;
    }
  }

  if (contract.amount === "tempInLondon") {
    contract.amount = (0, _oracles.getOracleByAddress)(agreedOracleAddress).getTempInLondon().toString();
  }

  if (contract.amount === "libor3m") {
    contract.amount = (0, _oracles.getOracleByAddress)(agreedOracleAddress).getLiborSpotRate().toString();
  }

  (0, _deploy.holderAddress)().then(function (holderAddress) {
    (0, _deploy.counterPartyAddress)().then(function (counterPartyAddress) {
      if (contract.recipient == 0) {
        // owner receives
        createMoveFile(counterPartyAddress, holderAddress, parseFloat(contract.amount));
        callTransferFunction(contract, counterPartyAddress, holderAddress);
      } else {
        // counter party receives
        createMoveFile(holderAddress, counterPartyAddress, parseFloat(contract.amount));
        callTransferFunction(contract, holderAddress, counterPartyAddress);
      }

      if (document.getElementById("td_status_" + contract.id).innerHTML !== "successful") {
        document.getElementById("td_status_" + contract.id).innerHTML = "not accepted by user";
      }
    });
  });
}

function callTransferFunction(contract, fromAddress, toAddress) {
  (0, _deploy.balanceOfAddress)(fromAddress).then(function (balance) {
    if (balance >= parseFloat(contract.amount)) {
      (0, _deploy.transfer)(fromAddress, toAddress, parseFloat(contract.amount)).then(function (transferTxHash) {
        (0, _deploy.waitForReceipt)(transferTxHash).then(function (_) {
          console.log(fromAddress + " has transferred " + contract.amount + " Ether to " + toAddress);
          document.getElementById("td_status_" + contract.id).innerHTML = "successful";
          deleteFromSuperContracts(contract.id.split(".")[0], contract);
          updateBalances();
          checkForEmptySuperContract();
        });
      });
    } else {
      window.alert("The sender address does not have enough Ether for this transfer. Please deposit more Ether into the account.");
      document.getElementById("td_status_" + contract.id).innerHTML = "insufficient funds";
    }
  });
}

function checkForEmptySuperContract() {
  var _iteratorNormalCompletion8 = true;
  var _didIteratorError8 = false;
  var _iteratorError8 = undefined;

  try {
    for (var _iterator8 = superContractsMap[Symbol.iterator](), _step8; !(_iteratorNormalCompletion8 = (_step8 = _iterator8.next()).done); _iteratorNormalCompletion8 = true) {
      var _step8$value = _slicedToArray(_step8.value, 2),
          superContractId = _step8$value[0],
          contractsSet = _step8$value[1];

      if (contractsSet.size === 0) {
        superContractsMap["delete"](superContractId);
        document.getElementById("acquire_button_" + superContractId).disabled = true;
      }
    }
  } catch (err) {
    _didIteratorError8 = true;
    _iteratorError8 = err;
  } finally {
    try {
      if (!_iteratorNormalCompletion8 && _iterator8["return"] != null) {
        _iterator8["return"]();
      }
    } finally {
      if (_didIteratorError8) {
        throw _iteratorError8;
      }
    }
  }
}

function createMoveFile(sender_address, recipient_address, amount) {
  var textToWrite = "//! no-execute\n" + "import 0x0.LibraAccount;\n" + "import 0x0.LibraCoin;\n \n" + "main(payee: address) {\n" + "\t let coin: R#LibraCoin.T;\n" + "\t let account_exists: bool;\n" + "\t let recipient: address;\n" + "\t let sender: address;\n" + "\t sender = " + sender_address + ";\n" + "\t recipient = " + recipient_address + ";\n" + "\t coin = LibraAccount.withdraw_from_sender(" + amount + ");\n" + "\t account_exists = LibraAccount.exists(copy(recipient));\n" + "\t if (!move(account_exists)) {\n" + "\t \t create_account(copy(recipient));\n" + "\t }\n" + "\t LibraAccount.deposit(move(recipient), move(coin));\n" + "\t return;\n" + "}";
  var textFileAsBlob = new Blob([textToWrite], {
    type: 'text/plain'
  });
  var downloadLink = document.createElement("a");
  downloadLink.download = "script.mvir";
  downloadLink.innerHTML = "Download Move File";

  if (window.webkitURL != null) {
    // Chrome allows the link to be clicked
    // without actually adding it to the DOM.
    downloadLink.href = window.webkitURL.createObjectURL(textFileAsBlob);
  } else {
    // Firefox requires the link to be added to the DOM
    // before it can be clicked.
    downloadLink.href = window.URL.createObjectURL(textFileAsBlob);
    downloadLink.onclick = destroyClickedElement;
    downloadLink.style.display = "none";
    document.body.appendChild(downloadLink);
  } //downloadLink.click(); // commented for testing purposes


  console.log("Created and downloaded .mvir file.");
}

function retrieveBalances() {
  (0, _deploy.holderBalance)().then(function (hBalance) {
    document.getElementById("holder_balance_p").innerHTML = "Balance: " + hBalance + "ETH";
    (0, _deploy.counterPartyBalance)().then(function (cBalance) {
      document.getElementById("counter_party_balance_p").innerHTML = "Balance: " + cBalance + "ETH";
    });
  });
}

function printStack(stack, name) {
  console.log(name + ": " + stack.length);
  var x;

  for (var x = 0; x < stack.length; ++x) {
    console.log(name + " - " + x + ": " + stack[x]);
  }
}

function createTableRow(contract) {
  var table = document.getElementById("my_table");
  var tr = table.insertRow(1);
  tr.className = "standard_row";
  var td;
  tr.appendChild(td = document.createElement("td"));
  td.innerHTML = contract.id;
  tr.appendChild(td = document.createElement("td"));
  td.innerHTML = (0, _stringmanipulation.changeDateFormatBack)(contract.contractString);
  tr.appendChild(td = document.createElement("td"));
  td.innerHTML = (0, _stringmanipulation.changeDateFormatBack)(contract.meaningOfContractString);
  tr.appendChild(td = document.createElement("td"));
  td.innerHTML = (0, _stringmanipulation.changeDateFormatBack)(contract.horizonDate);
  tr.appendChild(td = document.createElement("td"));
  td.innerHTML = contract.toBeExecutedAtHorizon;
  tr.appendChild(td = document.createElement("td"));
  td.id = "td_status_" + contract.id;
  td.innerHTML = contract.status;
  tr.appendChild(td = document.createElement("td"));
}

function correctUserTryingToAcquire() {
  if ((0, _deploy.getSelectedMetaMaskAccount)().toUpperCase() === document.getElementById("holder_address").value.toUpperCase()) {
    return true;
  } else {
    return false;
  }
}

function createButton(contractString, buttonId) {
  var button = document.createElement("button");
  button.id = "choices_button_" + buttonId;
  button.className = "choices_button";
  button.innerHTML = (0, _stringmanipulation.cleanParens)(contractString); // 2. Append somewhere

  var bottomContainer = document.getElementById("button_choices_container");
  bottomContainer.appendChild(button); // 3. Add event handler

  button.addEventListener("click", function () {
    decomposeContract(stringToAddToBeginning + button.innerHTML);
  });
}

function createSection() {
  var para = document.createElement("p");
  var node = document.createTextNode("Contract choice:");
  para.appendChild(node);
  var bottomContainer = document.getElementById("button_choices_container");
  bottomContainer.appendChild(para);
}

function createOrLabel() {
  var para = document.createElement("p");
  para.className = "p_small";
  var node = document.createTextNode("OR");
  para.appendChild(node);
  var bottomContainer = document.getElementById("button_choices_container");
  bottomContainer.appendChild(para);
}

function removeChildren(containerString) {
  var e = document.getElementById(containerString);
  var child = e.lastElementChild;

  while (child) {
    e.removeChild(child);
    child = e.lastElementChild;
  }
}

function isDate(stringInput) {
  var matches = stringInput.match(/^((0?[1-9])|([12][0-9])|(3[01]))\/((0?[1-9])|(1[0-2]))\/(\d\d\d\d)-((0[0-9])|(1[0-9])|(2[0-3])):([0-5][0-9]):([0-5][0-9])$/);

  if (matches === null) {
    return false;
  } else if (matches[0] === stringInput) {
    return true;
  } else {
    return false;
  }
}

global.testReachability = function () {
  decomposeContract("( scaleK 50 ( get ( truncate \"24/12/2019-23:33:33\" ( give one ) ) ) ) or ( zero and truncate \"26/12/2019-23:33:33\" ( give zero ) )");
  removeChildren("button_choices_container");
  decomposeContract("( scaleK 50 ( get ( truncate \"24/12/2019-23:33:33\" ( give one ) ) ) ) or ( zero or truncate \"26/12/2019-23:33:33\" ( give zero ) )");
  removeChildren("button_choices_container");
  decomposeContract("( scaleK 50 ( get ( truncate \"24/12/2019-23:33:33\" ( give one ) ) ) ) or zero");
  removeChildren("button_choices_container");
  decomposeContract("zero or give one");
  removeChildren("button_choices_container");
  decomposeContract("( ( zero or give one ) or scaleK 10 ( one ) ) or zero");
  removeChildren("button_choices_container");
  decomposeContract("( zero or give one ) or ( scaleK 10 one or zero )");
  removeChildren("button_choices_container");
  decomposeContract("( zero or one ) or scaleK 10 ( one )");
  removeChildren("button_choices_container");
  decomposeContract("give one or ( ( truncate \"24/12/2019-23:33:33\" ( give zero ) ) and give zero )");
  removeChildren("button_choices_container");
  decomposeContract("( zero or give one ) or ( ( scaleK 10 one ) or zero )");
  removeChildren("button_choices_container");
  decomposeContract("( zero or give one ) or ( ( scaleK 10 ( one ) ) or zero )");
  removeChildren("button_choices_container");
  decomposeContract("give one or ( ( truncate \"24/12/2019-23:33:33\" ( give zero ) ) or give zero )");
  removeChildren("button_choices_container");
  decomposeContract("truncate \"24/12/2019-23:33:33\" ( one or give zero )");
  removeChildren("button_choices_container");
  decomposeContract("truncate \"24/12/2019-23:33:33\" ( one ) or truncate \"24/12/2019-23:33:33\" ( zero )");
  removeChildren("button_choices_container");
  decomposeContract("( scaleK 101 ( get ( truncate \"24/01/2019-23:33:33\" ( one ) ) ) and scaleK 102 ( get ( truncate \"24/02/2019-23:33:33\" ( give one ) ) ) ) or ( ( scaleK 103 ( get ( truncate \"24/03/2019-23:33:33\" ( one ) ) ) and scaleK 104 ( get ( truncate \"24/04/2019-23:33:33\" ( give one ) ) ) ) or ( scaleK 105 ( get ( truncate \"24/05/2019-23:33:33\" ( one ) ) ) and scaleK 106 ( get ( truncate \"24/06/2019-23:33:33\" ( give one ) ) ) ) )");
  removeChildren("button_choices_container");
  decomposeContract("( scaleK 100 one and scaleK 101 one ) or ( ( scaleK 102 one and scaleK 103 one ) or ( scaleK 104 one and scaleK 105 one ) )");
  removeChildren("button_choices_container");
  decomposeContract("( one and give one ) or ( ( zero and give zero ) or ( give one and give zero ) )");
  removeChildren("button_choices_container");
  decomposeContract("( zero or give one ) or ( scaleK 10 ( one ) or zero )");
  removeChildren("button_choices_container");
};

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./contract.mjs":1,"./deploy/deploy.mjs":2,"./oracles.mjs":5,"./stringmanipulation.mjs":6}],5:[function(require,module,exports){
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.createOracles = createOracles;
exports.getOracleByAddress = getOracleByAddress;
exports.Oracle = void 0;

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

function _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }

/**
 * @author Noah-Vincenz Noeh <noah-vincenz.noeh18@imperial.ac.uk>
 */

/* jshint esversion: 6 */
var oracleArr = [];

var Oracle =
/*#__PURE__*/
function () {
  function Oracle(address) {
    _classCallCheck(this, Oracle);

    this.address = address;
  }

  _createClass(Oracle, [{
    key: "getTempInLondon",
    value: function getTempInLondon() {
      switch (this.address) {
        case "0x8ce40d9956e7b8a89a1d73f4d4850c760ea20a56":
          return 23;
          break;

        case "0xc90bc8ff4387fe14cdd0934ef9935be590cb83ca":
          return 25;
          break;

        case "0xa03cbbea9891d7961ed23fd965b6ad3109c36a30":
          return 22;
          break;

        case "0x90a3coyea9891d7961edo78h96b6ad3109c3659b":
          return 24;
          break;

        case "0xa89fbjs0033nkkklizqp04bj4jb5bjxxk4nb33n4":
          return 22;
          break;

        default: // code block

      }
    }
  }, {
    key: "getLiborSpotRate",
    value: function getLiborSpotRate() {
      switch (this.address) {
        case "0x8ce40d9956e7b8a89a1d73f4d4850c760ea20a56":
          return 2.26563;
          break;

        case "0xc90bc8ff4387fe14cdd0934ef9935be590cb83ca":
          return 2.25634;
          break;

        case "0xa03cbbea9891d7961ed23fd965b6ad3109c36a30":
          return 2.26551;
          break;

        case "0x90a3coyea9891d7961edo78h96b6ad3109c3659b":
          return 2.25555;
          break;

        case "0xa89fbjs0033nkkklizqp04bj4jb5bjxxk4nb33n4":
          return 2.25420;
          break;

        default: // code block

      }
    }
  }]);

  return Oracle;
}();

exports.Oracle = Oracle;

function createOracles() {
  var o1 = new Oracle("0x8ce40d9956e7b8a89a1d73f4d4850c760ea20a56");
  var o2 = new Oracle("0xc90bc8ff4387fe14cdd0934ef9935be590cb83ca");
  var o3 = new Oracle("0xa03cbbea9891d7961ed23fd965b6ad3109c36a30");
  var o4 = new Oracle("0x90a3coyea9891d7961edo78h96b6ad3109c3659b");
  var o5 = new Oracle("0xa89fbjs0033nkkklizqp04bj4jb5bjxxk4nb33n4");
  oracleArr = [o1, o2, o3, o4, o5];
}

function getOracleByAddress(address) {
  for (var i = 0; i < oracleArr.length; ++i) {
    if (oracleArr[i].address === address) {
      return oracleArr[i];
    }
  }
}

},{}],6:[function(require,module,exports){
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.cleanParens = cleanParens;
exports.changeDateFormat = changeDateFormat;
exports.changeDateFormatBack = changeDateFormatBack;
exports.addSpacing = addSpacing;
exports.addParens = addParens;
exports.openingParensAmount = openingParensAmount;
exports.closingParensAmount = closingParensAmount;
exports.lTrimWhiteSpace = lTrimWhiteSpace;
exports.rTrimWhiteSpace = rTrimWhiteSpace;
exports.lTrimParen = lTrimParen;
exports.rTrimParen = rTrimParen;
exports.lTrimBrace = lTrimBrace;
exports.rTrimBrace = rTrimBrace;
exports.lTrimDoubleQuotes = lTrimDoubleQuotes;
exports.rTrimDoubleQuotes = rTrimDoubleQuotes;
exports.trimSemiColon = trimSemiColon;

/**
 * @author Noah-Vincenz Noeh <noah-vincenz.noeh18@imperial.ac.uk>
 */

/* jshint esversion: 6 */
function cleanParens(contractString) {
  if (contractString[contractString.length - 1] === "(") {
    contractString = contractString.slice(0, -1);
  }

  if (contractString[0] === ")") {
    contractString = contractString.substring(1);
  }

  var contractStringArr = contractString.split(" ");

  while (openingParensAmount(contractString) > closingParensAmount(contractString) && (contractStringArr[0] === "(" || contractStringArr[0] === " " && contractStringArr[1] === "(")) {
    contractString = lTrimParen(lTrimWhiteSpace(contractString));
  }

  while (openingParensAmount(contractString) < closingParensAmount(contractString) && (contractStringArr[contractStringArr.length - 1] === ")" || contractStringArr[contractStringArr.length - 1] === " " && contractStringArr[contractStringArr.length - 2] === ")")) {
    contractString = rTrimParen(rTrimWhiteSpace(contractString));
  }

  return contractString;
}

function changeDateFormat(string) {
  var regex = /(.*)(\d\d\d\d)\s(\d\d)(.*)/;
  var matchObj = regex.exec(string);

  while (matchObj !== null) {
    string = matchObj[1] + matchObj[2] + "-" + matchObj[3] + matchObj[4];
    matchObj = regex.exec(string);
  }

  return string;
}

function changeDateFormatBack(string) {
  var regex = /(.*)(\d\d\d\d)-(\d\d)(.*)/;
  var matchObj = regex.exec(string);

  while (matchObj !== null) {
    string = matchObj[1] + matchObj[2] + " " + matchObj[3] + matchObj[4];
    matchObj = regex.exec(string);
  }

  return string;
}

function addSpacing(string) {
  // paren spacing
  var regex1 = /(.*\S)(\()(.*)/;
  var matchObj = regex1.exec(string);

  while (matchObj !== null) {
    string = matchObj[1] + " " + matchObj[2] + matchObj[3];
    matchObj = regex1.exec(string);
  }

  var regex2 = /(.*\S)(\))(.*)/;
  matchObj = regex2.exec(string);

  while (matchObj !== null) {
    string = matchObj[1] + " " + matchObj[2] + matchObj[3];
    matchObj = regex2.exec(string);
  }

  var regex3 = /(.*)(\()(\S.*)/;
  matchObj = regex3.exec(string);

  while (matchObj !== null) {
    string = matchObj[1] + matchObj[2] + " " + matchObj[3];
    matchObj = regex3.exec(string);
  }

  var regex4 = /(.*)(\))(\S.*)/;
  matchObj = regex4.exec(string);

  while (matchObj !== null) {
    string = matchObj[1] + matchObj[2] + " " + matchObj[3];
    matchObj = regex4.exec(string);
  } // braces spacing


  var regex5 = /(.*\S)({)([^<>=].*)/;
  var matchObj = regex5.exec(string);

  while (matchObj !== null) {
    string = matchObj[1] + " " + matchObj[2] + matchObj[3];
    matchObj = regex5.exec(string);
  }

  var regex6 = /(.*\S[^<>=\S])(})(.*)/;
  matchObj = regex6.exec(string);

  while (matchObj !== null) {
    string = matchObj[1] + " " + matchObj[2] + matchObj[3];
    matchObj = regex6.exec(string);
  }

  var regex7 = /(.*)({)([^<>=\S]\S.*)/;
  matchObj = regex7.exec(string);

  while (matchObj !== null) {
    string = matchObj[1] + matchObj[2] + " " + matchObj[3];
    matchObj = regex7.exec(string);
  }

  var regex8 = /(.*[^<>=])(})(\S.*)/;
  matchObj = regex8.exec(string);

  while (matchObj !== null) {
    string = matchObj[1] + matchObj[2] + " " + matchObj[3];
    matchObj = regex8.exec(string);
  }

  return string;
}

function addParens(contractString) {
  if (openingParensAmount(contractString) > closingParensAmount(contractString)) {
    contractString = contractString + " )";
  } else if (openingParensAmount(contractString) < closingParensAmount(contractString)) {
    contractString = "( " + contractString;
  }

  return contractString;
}

function openingParensAmount(string) {
  return string.split("(").length - 1;
}

function closingParensAmount(string) {
  return string.split(")").length - 1;
}

function lTrimWhiteSpace(str) {
  if (str == null) return str;
  return str.replace(/^\s+/g, '');
}

function rTrimWhiteSpace(str) {
  if (str == null) return str;
  return str.replace(/\s$/g, '');
}

function lTrimParen(str) {
  if (str == null) return str;
  return str.replace(/^\(+/g, '');
}

function rTrimParen(str) {
  if (str == null) return str;
  return str.replace(/\)$/g, '');
}

function lTrimBrace(str) {
  if (str == null) return str;
  return str.replace(/^\{+/g, '');
}

function rTrimBrace(str) {
  if (str == null) return str;
  return str.replace(/\}$/g, '');
}

function lTrimDoubleQuotes(str) {
  if (str == null) return str;
  return str.replace(/^\"+/g, '');
}

function rTrimDoubleQuotes(str) {
  if (str == null) return str;
  return str.replace(/\"$/g, '');
}

function trimSemiColon(str) {
  if (str == null) return str;
  return str.replace(/;/g, '');
}

},{}]},{},[4]);
